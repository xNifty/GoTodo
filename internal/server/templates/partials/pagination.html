<div class="row justify-content-center mb-5">
    <div>
        {{if .TotalTasks}}
        <!-- Show Total Tasks; Tasks Completed; Task Incomplete -->
         <div class="mb-3">
            <span id="total-tasks-badge" class="badge bg-primary me-2">Total Tasks: {{.TotalTasks}}</span>
            <span id="completed-tasks-badge" class="badge bg-success me-2">Completed: {{.CompletedTasks}}</span>
            <span id="incomplete-tasks-badge" class="badge bg-warning text-dark">Incomplete: {{.IncompleteTasks}}</span>
        <table class="table table-striped table-bordered w-100 mb-3">
            <input type="hidden" name="currentPage" value="{{.CurrentPage}}" />
                <thead>
                <tr>
                    <th style="width: 32px"></th>
                    <th class="description-column">Title</th>
                    <th class="description-column">Description</th>
                    <th class="date-added">Date Added</th>
                    <th class="actions-column">Actions</th>
                </tr>
            </thead>
            {{if eq .CurrentPage 1}}
            <tbody id="favorite-task-list">
                {{with .FavoriteTasks}}{{range .}} {{template "todo.html" .}} {{end}}{{end}}
            </tbody>
            {{end}}
            <tbody id="task-list">
                {{range .Tasks}} {{template "todo.html" .}} {{end}}
            </tbody>
        </table>
        </div>
        {{else if .LoggedIn}}
            {{if not .IsSearching}}
                <div class="card text-center" style="padding: 3rem;">
                    <div class="card-body">
                        <i class="bi bi-clipboard-check" style="font-size: 4rem; color: #6c757d;"></i>
                        <h3 class="mt-3">Add your first Todo!</h3>
                        <p class="text-muted">Click the "Add Task" button to add a new task!</p>
                    </div>
                </div>
            {{else}}
                <div class="card text-center" style="padding: 3rem;">
                    <div class="card-body">
                        <i class="bi bi-clipboard-check" style="font-size: 4rem; color: #6c757d;"></i>
                        <!-- <h3 class="mt-3">Add your first Todo!</h3> -->
                        <p class="text-muted">No results found</p>
                    </div>
                </div>
            {{end}}
        </div>
        {{else}}
        <div class="card text-center" style="padding: 3rem;">
            <div class="card-body">
                <h1 class="display-4 mb-4" style="font-weight: bold;">Welcome to GoTodo!</h1>
                <p class="lead" style="font-size: 1.5rem;">Organize your tasks and boost your productivity.</p>
                <p class="text-muted" style="font-size: 1.1rem;">Please log in to get started.</p>
            </div>
        </div>
        {{end}}

        {{if and .TotalTasks (gt .TotalTasks 0)}}
        <!-- Pagination Controls -->
        <div class="d-flex justify-content-center align-items-center">
            <!--
            <button
                hx-get="{{basePath}}/api/fetch-tasks?page={{.PreviousPage}}&search={{.SearchQuery}}"
                hx-target="#task-container"
                hx-swap="innerHTML"
                class="btn btn-outline-primary btn-sm"
                {{if .PrevDisabled}}disabled{{end}}
            >
                <i class="bi bi-chevron-left"></i> Previous
            </button>
            -->
            <div>
                {{ $ctx := . }}
                <div class="d-flex align-items-center gap-2">
                    <button class="btn btn-outline-primary btn-sm" type="button" 
                        title="Go to first page" aria-label="Go to first page"
                        hx-get="{{basePath}}/api/fetch-tasks?page=1&search={{$ctx.SearchQuery}}"
                        hx-target="#task-container" hx-swap="innerHTML" {{if eq $ctx.CurrentPage 1}}disabled{{end}}>&laquo;</button>

                    {{range $idx, $p := $ctx.Pages}}
                        {{if eq $p $ctx.CurrentPage}}
                            <button class="btn btn-primary btn-sm" type="button" aria-current="page" disabled>{{$p}}</button>
                        {{else}}
                            <button class="btn btn-outline-primary btn-sm" type="button"
                                hx-get="{{basePath}}/api/fetch-tasks?page={{$p}}&search={{$ctx.SearchQuery}}"
                                hx-target="#task-container" hx-swap="innerHTML">{{$p}}</button>
                        {{end}}
                    {{end}}

                    {{if $ctx.HasRightEllipsis}}
                        <span class="text-muted">&hellip;</span>
                        <button class="btn btn-outline-primary btn-sm" type="button"
                            title="Go to last page" aria-label="Go to last page"
                            hx-get="{{basePath}}/api/fetch-tasks?page={{$ctx.TotalPages}}&search={{$ctx.SearchQuery}}"
                            hx-target="#task-container" hx-swap="innerHTML">{{$ctx.TotalPages}}</button>
                    {{end}}

                    <button class="btn btn-outline-primary btn-sm" type="button"
                        title="Go to last page" aria-label="Go to last page"
                        hx-get="{{basePath}}/api/fetch-tasks?page={{$ctx.TotalPages}}&search={{$ctx.SearchQuery}}"
                        hx-target="#task-container" hx-swap="innerHTML" {{if eq $ctx.CurrentPage $ctx.TotalPages}}disabled{{end}}>&raquo;</button>
                </div>
            </div>
            <!--
            <button
                hx-get="{{basePath}}/api/fetch-tasks?page={{.NextPage}}&search={{.SearchQuery}}"
                hx-target="#task-container"
                hx-swap="innerHTML"
                class="btn btn-outline-primary btn-sm"
                {{if .NextDisabled}}disabled{{end}}
            >
                Next <i class="bi bi-chevron-right"></i>
            </button>
            -->
        </div>
        {{end}}
        {{if .LoggedIn}}
        <!-- Modal -->
        <div id="modal" class="modal fade" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <!-- Modal content dynamically loaded -->
                </div>
            </div>
        </div>
            {{template "sidebar.html" .}}
        {{end}}
    </div>
</div>


