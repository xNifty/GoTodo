(()=>{window.apiPath=function(m){return"./"+(m.startsWith("/")?m.slice(1):m)};document.addEventListener("DOMContentLoaded",()=>{let m=document.getElementById("sidebar"),F=document.getElementById("openSidebar"),z=document.getElementById("closeSidebar"),q=document.getElementById("description"),v=document.getElementById("char-count"),C=null;(function(){try{let t=document.querySelector("footer");t&&(C=t.outerHTML)}catch{}})();function V(){try{if(!document.querySelector("footer")&&C){let e=document.getElementById("task-container");if(e&&e.parentNode){let t=document.createElement("div");t.innerHTML=C,e.nextSibling?e.parentNode.insertBefore(t.firstElementChild,e.nextSibling):e.parentNode.appendChild(t.firstElementChild)}else{let t=document.createElement("div");t.innerHTML=C,document.body.appendChild(t.firstElementChild)}}}catch{}}q&&v&&q.addEventListener("input",function(){let e=this.value.length;v.textContent=e,e>90?v.classList.add("text-warning"):v.classList.remove("text-warning"),e>95?v.classList.add("text-danger"):v.classList.remove("text-danger")});let M=document.getElementById("project-name"),L=document.getElementById("project-name-char-count");M&&L&&M.addEventListener("input",function(){let e=this.value.length;L.textContent=e,e>40?L.classList.add("text-warning"):L.classList.remove("text-warning"),e>45?L.classList.add("text-danger"):L.classList.remove("text-danger")});function H(){let e=document.getElementById("createProjectForm"),t=document.getElementById("project-name"),n=document.getElementById("project-name-error");e&&t&&n&&(t.addEventListener("input",function(){n.innerHTML=""}),e.addEventListener("htmx:afterRequest",function(o){let a=!1;try{let c=o.detail&&o.detail.xhr,r=c&&c.getResponseHeader?c.getResponseHeader("X-Validation-Error"):null;(r&&r.toLowerCase()==="true"||o.detail&&o.detail.triggerSpec&&o.detail.triggerSpec.trigger==="project-name-error")&&(a=!0)}catch{}if(o.detail.successful&&!a){t.value="";let c=document.getElementById("project-name-char-count");c&&(c.textContent="0"),n.innerHTML=""}}))}H();function w(){let e=document.getElementById("theme-toggle"),n=document.documentElement.getAttribute("data-theme")||localStorage.getItem("theme")||"light";document.documentElement.setAttribute("data-theme",n),n==="dark"?e&&e.classList.add("active"):e&&e.classList.remove("active")}function T(){let t=(document.documentElement.getAttribute("data-theme")||"light")==="light"?"dark":"light",n=document.getElementById("theme-toggle");document.documentElement.setAttribute("data-theme",t),localStorage.setItem("theme",t);try{document.cookie="theme="+t+"; path=/; max-age=31536000; SameSite=Lax"}catch{}t==="dark"?n&&n.classList.add("active"):n&&n.classList.remove("active")}w();let P=document.getElementById("theme-toggle");P&&P.addEventListener("click",T);function A(){m=document.getElementById("sidebar"),m&&m.classList.add("active")}function I(){m=document.getElementById("sidebar"),m&&m.classList.remove("active")}function E(){let e=document.getElementById("openSidebar"),t=document.getElementById("closeSidebar");e&&(e.removeEventListener("click",A),e.addEventListener("click",function(o){try{let a=document.getElementById("newTaskForm");if(a){let c=a.querySelector("#title");c&&(c.value="");let r=a.querySelector("#description");r&&(r.value="");let i=a.querySelector("#project_id");i&&(i.value="");let d=a.querySelector('input[name="id"]');d&&d.remove();let s=a.querySelector('button[type="submit"]');s&&(s.textContent="Add Task");try{a.setAttribute("hx-post",apiPath("/api/add-task"))}catch{}let l=a.querySelector('input[name="currentPage"]');l&&(l.value="1");try{let f=a.querySelector('input[name="project"]'),y=document.querySelector("select#project-filter"),h=y?y.value:"";f||(f=document.createElement("input"),f.type="hidden",f.name="project",a.appendChild(f)),f.value=h}catch{}let u=document.querySelector("#sidebar .sidebar-header h5");u&&(u.textContent="Add Task");let x=document.getElementById("char-count");x&&(x.textContent="0")}}catch{}A()})),t&&(t.removeEventListener("click",I),t.addEventListener("click",I));let n=document.getElementById("theme-toggle");n&&(n.removeEventListener("click",T),n.addEventListener("click",T));try{let o=document.getElementById("newTaskForm");if(o&&!o.classList.contains("task-form-initialized")){try{let a=o.querySelector('input[name="project"]'),c=document.querySelector("select#project-filter"),r=c?c.value:"";a||(a=document.createElement("input"),a.type="hidden",a.name="project",o.appendChild(a)),a.value=r,o.addEventListener("submit",function(){try{let i=document.querySelector("select#project-filter");i&&(a.value=i.value)}catch{}})}catch{}o.addEventListener("htmx:afterRequest",a=>{let c=!1;try{let r=a.detail&&a.detail.xhr,i=r&&r.getResponseHeader?r.getResponseHeader("X-Validation-Error"):null;(i&&i.toLowerCase()==="true"||a.detail&&a.detail.triggerSpec&&a.detail.triggerSpec.trigger==="description-error")&&(c=!0)}catch{}if(a.detail.successful&&!c){I();let r=document.getElementById("title");r&&(r.value="");let i=document.getElementById("description");i&&(i.value="");let d=document.getElementById("char-count");d&&(d.textContent="0");let s=document.getElementById("description-error");s&&(s.innerHTML="")}}),o.classList.add("task-form-initialized")}}catch{}}E(),document.body.addEventListener("htmx:afterSettle",e=>{e.target.id==="task-container"&&(E(),m=document.getElementById("sidebar"),m&&m.classList.contains("htmx-added")&&m.classList.add("active"))});function j(){try{if(typeof Sortable>"u")return;let e=document.getElementById("favorite-task-list"),t=document.getElementById("task-list"),n=(o,a)=>{if(o){if(o._sortable)try{o._sortable.destroy()}catch{}o._sortable=Sortable.create(o,{handle:".drag-handle",animation:150,onEnd:function(c){let r=Array.from(c.to.children).map(s=>(s.id||"").replace("task-","")).filter(Boolean).join(","),i=new URLSearchParams;i.append("order",r),i.append("is_favorite",a?"true":"false");let d=document.querySelector('#task-container [name="currentPage"]');d&&d.value&&i.append("page",d.value);try{let s=document.querySelector("select#project-filter"),l=s?s.value:"";typeof l<"u"&&l!==null&&i.append("project",l)}catch{}fetch(apiPath("/api/reorder-tasks"),{method:"POST",body:i}).then(s=>{if(s.ok)return s.text();throw new Error("Failed to save order")}).then(s=>{let l=document.getElementById("task-container");if(l){l.innerHTML=s;try{typeof htmx<"u"&&htmx.process(l)}catch{}try{j()}catch{}try{typeof E=="function"&&E()}catch{}try{typeof B=="function"&&B()}catch{}try{V()}catch{}}}).catch(s=>{console.error("Reorder failed",s)})}})}};n(e,!0),n(t,!1)}catch{}}j(),document.body.addEventListener("htmx:afterSwap",function(e){if(e.target.id==="task-container"){try{O(),$()}catch{}j()}});function $(){let e=document.getElementById("task-container");if(!e)return;let t=e.querySelector("table");if(!t)return;["table","table-striped","table-bordered","w-100","mb-3"].forEach(o=>{t.classList.contains(o)||t.classList.add(o)})}function O(){let e=document.getElementById("task-container");if(!e||e.querySelector("table"))return;let t=e.querySelector("#favorite-task-list"),n=e.querySelector("#task-list"),o=[];if(t&&o.push(t),n&&o.push(n),o.length===0){let i=Array.from(e.querySelectorAll(":scope > tr"));i.length&&o.push(...i)}if(o.length===0)return;let a=document.createElement("table");a.className="table table-striped table-bordered w-100 mb-3";let c=e.querySelector("thead");if(c){a.appendChild(c.cloneNode(!0));try{c.remove()}catch{}}let r=document.createElement("tbody");o.forEach(i=>{r.appendChild(i)}),a.appendChild(r),e.insertBefore(a,e.firstChild)}let S=document.getElementById("modal");S&&(S.addEventListener("hide.bs.modal",()=>{document.activeElement instanceof HTMLElement&&document.activeElement.blur()}),S.addEventListener("hidden.bs.modal",()=>{S.setAttribute("aria-hidden","true")}));function B(){let e=document.getElementById("modal");if(e){e.classList.contains("modal-listeners-initialized")||(e.addEventListener("hide.bs.modal",()=>{document.activeElement instanceof HTMLElement&&document.activeElement.blur()}),e.addEventListener("hidden.bs.modal",()=>{e.setAttribute("aria-hidden","true")}),e.classList.add("modal-listeners-initialized"));try{typeof bootstrap<"u"&&bootstrap.Modal&&typeof bootstrap.Modal.getOrCreateInstance=="function"&&bootstrap.Modal.getOrCreateInstance(e)}catch{}}}B();function _(e){let t=document.getElementById("changelog-body");if(!t)return;if(!e||!e.length){t.innerHTML='<div class="text-center text-muted">No changelog entries available.</div>';return}let n=document.createElement("div");n.className="changelog-list";let a=e.slice(0,5);if(a.forEach((c,r)=>{let i=document.createElement("div");i.className="card mb-3";let d=document.createElement("div");d.className="card-body";let s=document.createElement("button");s.type="button",s.className="btn btn-link text-start w-100 p-0 d-flex align-items-center",s.style.textDecoration="none";let l=document.createElement("span");l.className="chev me-2",l.textContent="\u25BA",s.appendChild(l);let u=document.createElement("div");u.className="flex-grow-1 text-start";let x=document.createElement("strong");x.textContent=c.title||"",u.appendChild(x);let f=document.createElement("span");f.className="badge releasetag ms-3 "+(c.prerelease?"bg-warning text-dark":"bg-success"),f.textContent=(c.prerelease?"Prerelease":"Release")+" \u2022 "+(c.date||""),u.appendChild(f),s.appendChild(u),d.appendChild(s);let y=document.createElement("div");if(y.id=`changelog-modal-${r}-${Date.now()}`,y.className="collapse mt-2",c.html){let h=document.createElement("div");h.className="changelog-entry-body",h.innerHTML=c.html;try{let p=h.querySelector("h1,h2,h3,h4,h5,h6");if(p){let b=p.querySelector("a");b&&(b.textContent=c.title||b.getAttribute("title")||b.textContent||"")}}catch{}let g=h.firstElementChild;try{if(g&&(g.tagName==="P"||g.tagName==="DIV"||g.tagName==="PRE")){let p=(g.textContent||"").trim().toLowerCase(),b=(c.version||"").toLowerCase(),D=(c.date||"").toLowerCase();(b&&p.includes(b)||D&&p.includes(D)||p.includes(" - "))&&g.remove()}}catch{}y.appendChild(h)}else{let h=document.createElement("ul");Array.isArray(c.notes)&&c.notes.forEach(g=>{let p=document.createElement("li");p.textContent=g,h.appendChild(p)}),y.appendChild(h)}s.addEventListener("click",function(h){h.preventDefault();let g=y.classList.toggle("show");l.textContent=g?"\u25BC":"\u25BA"}),d.appendChild(y),i.appendChild(d),n.appendChild(i)}),e.length>a.length){let c=document.createElement("div");c.className="text-center mt-3";let r=document.createElement("a");r.href=apiPath("/changelog/page"),r.textContent="View full changelog",c.appendChild(r),n.appendChild(c)}t.innerHTML="",t.appendChild(n)}function N(){let e=document.getElementById("changelog-body");e&&(e.innerHTML='<div class="text-center text-muted">Loading...</div>'),fetch(apiPath("/changelog")).then(t=>{if(!t.ok)throw new Error("failed to load changelog");return t.json()}).then(t=>{_(t)}).catch(t=>{let n=document.getElementById("changelog-body");n&&(n.innerHTML='<div class="text-danger">Unable to load changelog.</div>'),console.error(t)})}let R=document.getElementById("changelogModal");if(R)try{R.addEventListener("show.bs.modal",N)}catch{let t=document.querySelector('[data-bs-target="#changelogModal"]');t&&t.addEventListener("click",N)}(function(){try{if(!new URLSearchParams(window.location.search).get("cssdebug"))return;let n={"max-420":"(max-width: 420px)","max-600":"(max-width: 600px)","max-768":"(max-width: 768px)","max-1024":"(max-width: 1024px)","pointer-coarse":"(pointer: coarse)","hover-none":"(hover: none)"};console.groupCollapsed("CSS Debug \u2014 media query matches"),Object.entries(n).forEach(([o,a])=>{try{let c=window.matchMedia(a);console.log(a+":",c.matches)}catch{console.log(a+": error")}}),console.log("navigator.maxTouchPoints:",navigator.maxTouchPoints),console.log("ontouchstart in window:","ontouchstart"in window),console.groupEnd()}catch{}})(),document.body.addEventListener("taskDeleted",function(e){let t=document.querySelectorAll("#task-container span"),n=1;for(let c of t){let r=c.textContent.match(/Page\s+(\d+)\s+of\s+(\d+)/);if(r){n=parseInt(r[1]);break}}let o=`/api/fetch-tasks?page=${n}`,a=document.getElementById("search");a&&a.value&&(o+=`&search=${encodeURIComponent(a.value)}`),htmx.ajax("GET",o,{target:"#task-container",swap:"innerHTML"})}),document.body.addEventListener("reloadPage",function(e){let n=`/api/fetch-tasks?page=${e.detail.page||1}`,o=document.getElementById("search");o&&o.value&&(n+=`&search=${encodeURIComponent(o.value)}`),htmx.ajax("GET",n,{target:"#task-container",swap:"innerHTML"})}),document.body.addEventListener("reload-previous-page",function(e){let t=document.querySelectorAll("#task-container span"),n=1;for(let i of t){let d=i.textContent.match(/Page\s+(\d+)\s+of\s+(\d+)/);if(d){n=parseInt(d[1]);break}}let o=Math.max(n-1,1),a=document.getElementById("search"),c=a?a.value:"",r=`/api/fetch-tasks?page=${o}`;c&&(r+=`&search=${encodeURIComponent(c)}`),htmx.ajax("GET",r,{target:"#task-container",swap:"innerHTML"})}),document.body.addEventListener("login-success",function(e){let t=bootstrap.Modal.getInstance(document.getElementById("modal"));t&&t.hide(),window.location.reload()}),document.body.addEventListener("taskCountsChanged",function(e){try{let t=e.detail||{};if(typeof t.completed<"u"){let n=document.getElementById("completed-tasks-badge");n&&(n.textContent=`Completed: ${t.completed}`)}if(typeof t.incomplete<"u"){let n=document.getElementById("incomplete-tasks-badge");n&&(n.textContent=`Incomplete: ${t.incomplete}`)}if(typeof t.completed<"u"&&typeof t.incomplete<"u"){let n=document.getElementById("total-tasks-badge");n&&(n.textContent=`Total Tasks: ${t.completed+t.incomplete}`)}}catch{}});function U(){let e=document.querySelector(".app-toast-container");return e||(e=document.createElement("div"),e.className="app-toast-container",document.body.appendChild(e)),e}function k(e,t){t=t||{};let n=U(),o=document.createElement("div");o.className="app-toast"+(t.error?" app-toast--error":""),o.setAttribute("role","status"),o.setAttribute("aria-live","polite"),o.textContent=e,n.appendChild(o),requestAnimationFrame(()=>{o.classList.add("show")});let a=typeof t.duration=="number"?t.duration:3500,c=()=>{o.classList.remove("show"),setTimeout(()=>{try{o.remove()}catch{}},220)},r=setTimeout(c,a);o.addEventListener("click",function(){clearTimeout(r),c()})}document.body.addEventListener("favorite-limit-reached",function(e){try{let t=e&&e.detail&&e.detail.message||"You can only favorite up to 5 tasks";k(t,{error:!0})}catch{k("You can only favorite up to 5 tasks",{error:!0})}}),document.body.addEventListener("click",function(e){try{if(!(e.target&&e.target.closest&&e.target.closest(".edit-btn")))return;let n=document.getElementById("sidebar");n&&n.classList.add("active")}catch{}}),document.body.addEventListener("click",function(e){try{if(!(e.target&&e.target.closest&&e.target.closest("#closeSidebar")))return;I()}catch{}}),document.body.addEventListener("htmx:afterSwap",e=>{let t=document.getElementById("sidebar");if(t&&t.classList.contains("active")){let n=document.getElementById("description"),o=document.getElementById("char-count");n&&o&&(o.textContent=n.value.length,n.classList.contains("char-count-listener-added")||(n.addEventListener("input",function(){let a=this.value.length;o.textContent=a,a>90?o.classList.add("text-warning"):o.classList.remove("text-warning"),a>95?o.classList.add("text-danger"):o.classList.remove("text-danger")}),n.classList.add("char-count-listener-added"))),typeof w=="function"&&w()}}),document.body.addEventListener("htmx:afterSwap",function(e){try{let t=e.detail&&e.detail.target?e.detail.target:e.target;if(t&&t.id==="sidebar"){try{E()}catch{}let n=document.getElementById("sidebar");n&&n.classList.add("active")}}catch{}}),document.body.addEventListener("htmx:afterSwap",function(e){try{let t=e&&e.detail,n=t&&t.target?t.target:e.target;if(n&&n.id==="sidebar")return;if(n&&n.classList&&n.classList.contains("sidebar-body")){try{E()}catch{}let o=document.getElementById("sidebar");o&&o.classList.add("active")}}catch{}}),document.body.addEventListener("htmx:afterRequest",function(e){try{let t=e&&e.detail&&e.detail.xhr;if(!t||!t.responseURL)return;if(t.responseURL.includes("/api/edit")){let n=t.status||0;if(n>=200&&n<300){try{E()}catch{}let o=document.getElementById("sidebar");o&&o.classList.add("active")}}if(t.responseURL.includes("/api/projects/create")){let n=t.status||0,o=t.getResponseHeader&&t.getResponseHeader("X-Validation-Error")==="true";if(n>=200&&n<300&&!o)try{let a=document.getElementById("createProjectForm");if(a){let c=a.querySelector('input[name="name"]');c&&(c.value="");let r=document.getElementById("project-name-char-count");r&&(r.textContent="0");let i=document.getElementById("project-name-error");i&&(i.innerHTML="")}H(),typeof k=="function"&&k("Project created.")}catch{}}try{if(t&&t.getResponseHeader&&t.getResponseHeader("HX-Trigger")){let n=t.getResponseHeader("HX-Trigger");if(n&&n.indexOf("projects-changed")!==-1&&fetch(apiPath("/api/projects/json")).then(o=>o.json()).then(o=>{try{document.querySelectorAll("select#project_id").forEach(c=>{let r=c.value;for(;c.options.length>1;)c.remove(1);o.forEach(i=>{let d=document.createElement("option");d.value=i.id,d.textContent=i.name,c.appendChild(d)});try{c.value=r}catch{}})}catch{}}).catch(()=>{}),n&&n.indexOf("reset-project-filter")!==-1)try{let o=document.querySelector("select#project-filter");o&&(o.value="",o.dispatchEvent(new Event("change",{bubbles:!0})))}catch{}if(n&&n.indexOf("set-project-filter")!==-1)try{let o=n.match(/set-project-filter:([^\s]+)/);if(o&&o[1]!==void 0){let a=o[1],c=document.querySelector("select#project-filter");c&&(c.value=a)}}catch{}}}catch{}}catch{}}),document.body.addEventListener("htmx:afterSwap",function(e){if(e.target&&e.target.id==="task-container")try{B()}catch{}})});})();
