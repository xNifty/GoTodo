(()=>{window.apiPath=function(m){return"./"+(m.startsWith("/")?m.slice(1):m)};document.addEventListener("DOMContentLoaded",()=>{let m=document.getElementById("sidebar"),M=document.getElementById("openSidebar"),R=document.getElementById("closeSidebar"),x=document.getElementById("description"),g=document.getElementById("char-count"),f=null;(function(){try{let t=document.querySelector("footer");t&&(f=t.outerHTML)}catch{}})();function A(){try{if(!document.querySelector("footer")&&f){let e=document.getElementById("task-container");if(e&&e.parentNode){let t=document.createElement("div");t.innerHTML=f,e.nextSibling?e.parentNode.insertBefore(t.firstElementChild,e.nextSibling):e.parentNode.appendChild(t.firstElementChild)}else{let t=document.createElement("div");t.innerHTML=f,document.body.appendChild(t.firstElementChild)}}}catch{}}x&&g&&x.addEventListener("input",function(){let e=this.value.length;g.textContent=e,e>90?g.classList.add("text-warning"):g.classList.remove("text-warning"),e>95?g.classList.add("text-danger"):g.classList.remove("text-danger")});function y(){let e=document.getElementById("theme-toggle"),n=document.documentElement.getAttribute("data-theme")||localStorage.getItem("theme")||"light";document.documentElement.setAttribute("data-theme",n),n==="dark"?e&&e.classList.add("active"):e&&e.classList.remove("active")}function b(){let t=(document.documentElement.getAttribute("data-theme")||"light")==="light"?"dark":"light",n=document.getElementById("theme-toggle");document.documentElement.setAttribute("data-theme",t),localStorage.setItem("theme",t);try{document.cookie="theme="+t+"; path=/; max-age=31536000; SameSite=Lax"}catch{}t==="dark"?n&&n.classList.add("active"):n&&n.classList.remove("active")}y();let C=document.getElementById("theme-toggle");C&&C.addEventListener("click",b);function k(){m=document.getElementById("sidebar"),m&&m.classList.add("active")}function v(){m=document.getElementById("sidebar"),m&&m.classList.remove("active")}function h(){let e=document.getElementById("openSidebar"),t=document.getElementById("closeSidebar");e&&(e.removeEventListener("click",k),e.addEventListener("click",k)),t&&(t.removeEventListener("click",v),t.addEventListener("click",v));let n=document.getElementById("theme-toggle");n&&(n.removeEventListener("click",b),n.addEventListener("click",b))}h(),document.body.addEventListener("htmx:afterSettle",e=>{e.target.id==="task-container"&&(h(),m=document.getElementById("sidebar"),m&&m.classList.contains("htmx-added")&&m.classList.add("active"))});function L(){try{if(typeof Sortable>"u")return;let e=document.getElementById("favorite-task-list"),t=document.getElementById("task-list"),n=(a,c)=>{if(a){if(a._sortable)try{a._sortable.destroy()}catch{}a._sortable=Sortable.create(a,{handle:".drag-handle",animation:150,onEnd:function(o){let r=Array.from(o.to.children).map(l=>(l.id||"").replace("task-","")).filter(Boolean).join(","),s=new URLSearchParams;s.append("order",r),s.append("is_favorite",c?"true":"false");let d=document.querySelector('#task-container [name="currentPage"]');d&&d.value&&s.append("page",d.value),fetch("/api/reorder-tasks",{method:"POST",body:s}).then(l=>{if(l.ok)return l.text();throw new Error("Failed to save order")}).then(l=>{let i=document.getElementById("task-container");if(i){i.innerHTML=l;try{typeof htmx<"u"&&htmx.process(i)}catch{}try{L()}catch{}try{typeof h=="function"&&h()}catch{}try{typeof E=="function"&&E()}catch{}try{A()}catch{}}}).catch(l=>{console.error("Reorder failed",l)})}})}};n(e,!0),n(t,!1)}catch{}}L(),document.body.addEventListener("htmx:afterSwap",function(e){if(e.target.id==="task-container"){try{P(),N()}catch{}L()}});function N(){let e=document.getElementById("task-container");if(!e)return;let t=e.querySelector("table");if(!t)return;["table","table-striped","table-bordered","w-100","mb-3"].forEach(a=>{t.classList.contains(a)||t.classList.add(a)})}function P(){let e=document.getElementById("task-container");if(!e||e.querySelector("table"))return;let t=e.querySelector("#favorite-task-list"),n=e.querySelector("#task-list"),a=[];if(t&&a.push(t),n&&a.push(n),a.length===0){let s=Array.from(e.querySelectorAll(":scope > tr"));s.length&&a.push(...s)}if(a.length===0)return;let c=document.createElement("table");c.className="table table-striped table-bordered w-100 mb-3";let o=e.querySelector("thead");if(o){c.appendChild(o.cloneNode(!0));try{o.remove()}catch{}}let r=document.createElement("tbody");a.forEach(s=>{r.appendChild(s)}),c.appendChild(r),e.insertBefore(c,e.firstChild)}let I=document.getElementById("newTaskForm");I&&I.addEventListener("htmx:afterRequest",e=>{let t=!1;try{let n=e.detail&&e.detail.xhr,a=n&&n.getResponseHeader?n.getResponseHeader("X-Validation-Error"):null;(a&&a.toLowerCase()==="true"||e.detail&&e.detail.triggerSpec&&e.detail.triggerSpec.trigger==="description-error")&&(t=!0)}catch{}if(e.detail.successful&&!t){v();let n=document.getElementById("title");n&&(n.value="");let a=document.getElementById("description");a&&(a.value="");let c=document.getElementById("char-count");c&&(c.textContent="0");let o=document.getElementById("description-error");o&&(o.innerHTML="")}else if(t)return});let p=document.getElementById("modal");p&&(p.addEventListener("hide.bs.modal",()=>{document.activeElement instanceof HTMLElement&&document.activeElement.blur()}),p.addEventListener("hidden.bs.modal",()=>{p.setAttribute("aria-hidden","true")}));function E(){let e=document.getElementById("modal");if(e){e.classList.contains("modal-listeners-initialized")||(e.addEventListener("hide.bs.modal",()=>{document.activeElement instanceof HTMLElement&&document.activeElement.blur()}),e.addEventListener("hidden.bs.modal",()=>{e.setAttribute("aria-hidden","true")}),e.classList.add("modal-listeners-initialized"));try{typeof bootstrap<"u"&&bootstrap.Modal&&typeof bootstrap.Modal.getOrCreateInstance=="function"&&bootstrap.Modal.getOrCreateInstance(e)}catch{}}}E();function H(e){let t=document.getElementById("changelog-body");if(!t)return;if(!e||!e.length){t.innerHTML='<div class="text-center text-muted">No changelog entries available.</div>';return}let n=document.createElement("div");n.className="changelog-list";let c=e.slice(0,5);if(c.forEach(o=>{let r=document.createElement("div");if(r.className="mb-3",o.html){let s=document.createElement("div");s.className="changelog-entry-body mt-2",s.innerHTML=o.html;let d=s.firstElementChild;try{if(d&&(d.tagName==="P"||d.tagName==="DIV"||d.tagName==="PRE")){let i=(d.textContent||"").trim().toLowerCase(),u=(o.version||"").toLowerCase(),T=(o.date||"").toLowerCase();(u&&i.includes(u)||T&&i.includes(T)||i.includes(" - "))&&d.remove()}}catch{}let l=s.querySelector("h1,h2,h3,h4,h5,h6");if(l){let i=document.createElement("span");i.className="badge releasetag ms-3 "+(o.prerelease?"bg-warning text-dark":"bg-success"),i.textContent=(o.prerelease?"Prerelease":"Release")+" \u2022 "+(o.date||""),l.appendChild(i)}else{let i=document.createElement("div");i.className="fw-bold mb-1",i.textContent=`${o.version} \u2014 ${o.title}`;let u=document.createElement("span");u.className="badge releasetag ms-2 "+(o.prerelease?"bg-warning text-dark":"bg-success"),u.textContent=(o.prerelease?"Prerelease":"Release")+" \u2022 "+(o.date||""),i.appendChild(u),r.appendChild(i)}r.appendChild(s)}else{let s=document.createElement("ul");Array.isArray(o.notes)&&o.notes.forEach(i=>{let u=document.createElement("li");u.textContent=i,s.appendChild(u)});let d=document.createElement("div");d.className="fw-bold mb-1",d.textContent=`${o.version} \u2014 ${o.title}`;let l=document.createElement("span");l.className="badge releasetag ms-2 "+(o.prerelease?"bg-warning text-dark":"bg-success"),l.textContent=(o.prerelease?"Prerelease":"Release")+" \u2022 "+(o.date||""),d.appendChild(l),r.appendChild(d),r.appendChild(s)}n.appendChild(r)}),e.length>c.length){let o=document.createElement("div");o.className="text-center mt-3";let r=document.createElement("a");r.href=apiPath("/changelog/page"),r.target="_blank",r.textContent="View full changelog",o.appendChild(r),n.appendChild(o)}t.innerHTML="",t.appendChild(n)}function w(){let e=document.getElementById("changelog-body");e&&(e.innerHTML='<div class="text-center text-muted">Loading...</div>'),fetch(apiPath("/changelog")).then(t=>{if(!t.ok)throw new Error("failed to load changelog");return t.json()}).then(t=>{H(t)}).catch(t=>{let n=document.getElementById("changelog-body");n&&(n.innerHTML='<div class="text-danger">Unable to load changelog.</div>'),console.error(t)})}let B=document.getElementById("changelogModal");if(B)try{B.addEventListener("show.bs.modal",w)}catch{let t=document.querySelector('[data-bs-target="#changelogModal"]');t&&t.addEventListener("click",w)}(function(){try{if(!new URLSearchParams(window.location.search).get("cssdebug"))return;let n={"max-420":"(max-width: 420px)","max-600":"(max-width: 600px)","max-768":"(max-width: 768px)","max-1024":"(max-width: 1024px)","pointer-coarse":"(pointer: coarse)","hover-none":"(hover: none)"};console.groupCollapsed("CSS Debug \u2014 media query matches"),Object.entries(n).forEach(([a,c])=>{try{let o=window.matchMedia(c);console.log(c+":",o.matches)}catch{console.log(c+": error")}}),console.log("navigator.maxTouchPoints:",navigator.maxTouchPoints),console.log("ontouchstart in window:","ontouchstart"in window),console.groupEnd()}catch{}})(),document.body.addEventListener("taskDeleted",function(e){let t=document.querySelectorAll("#task-container span"),n=1;for(let o of t){let r=o.textContent.match(/Page\s+(\d+)\s+of\s+(\d+)/);if(r){n=parseInt(r[1]);break}}let a=`/api/fetch-tasks?page=${n}`,c=document.getElementById("search");c&&c.value&&(a+=`&search=${encodeURIComponent(c.value)}`),htmx.ajax("GET",a,{target:"#task-container",swap:"innerHTML"})}),document.body.addEventListener("reloadPage",function(e){let n=`/api/fetch-tasks?page=${e.detail.page||1}`,a=document.getElementById("search");a&&a.value&&(n+=`&search=${encodeURIComponent(a.value)}`),htmx.ajax("GET",n,{target:"#task-container",swap:"innerHTML"})}),document.body.addEventListener("reload-previous-page",function(e){let t=document.querySelectorAll("#task-container span"),n=1;for(let s of t){let d=s.textContent.match(/Page\s+(\d+)\s+of\s+(\d+)/);if(d){n=parseInt(d[1]);break}}let a=Math.max(n-1,1),c=document.getElementById("search"),o=c?c.value:"",r=`/api/fetch-tasks?page=${a}`;o&&(r+=`&search=${encodeURIComponent(o)}`),htmx.ajax("GET",r,{target:"#task-container",swap:"innerHTML"})}),document.body.addEventListener("login-success",function(e){let t=bootstrap.Modal.getInstance(document.getElementById("modal"));t&&t.hide(),window.location.reload()}),document.body.addEventListener("taskCountsChanged",function(e){try{let t=e.detail||{};if(typeof t.completed<"u"){let n=document.getElementById("completed-tasks-badge");n&&(n.textContent=`Completed: ${t.completed}`)}if(typeof t.incomplete<"u"){let n=document.getElementById("incomplete-tasks-badge");n&&(n.textContent=`Incomplete: ${t.incomplete}`)}if(typeof t.completed<"u"&&typeof t.incomplete<"u"){let n=document.getElementById("total-tasks-badge");n&&(n.textContent=`Total Tasks: ${t.completed+t.incomplete}`)}}catch{}});function q(){let e=document.querySelector(".app-toast-container");return e||(e=document.createElement("div"),e.className="app-toast-container",document.body.appendChild(e)),e}function S(e,t){t=t||{};let n=q(),a=document.createElement("div");a.className="app-toast"+(t.error?" app-toast--error":""),a.setAttribute("role","status"),a.setAttribute("aria-live","polite"),a.textContent=e,n.appendChild(a),requestAnimationFrame(()=>{a.classList.add("show")});let c=typeof t.duration=="number"?t.duration:3500,o=()=>{a.classList.remove("show"),setTimeout(()=>{try{a.remove()}catch{}},220)},r=setTimeout(o,c);a.addEventListener("click",function(){clearTimeout(r),o()})}document.body.addEventListener("favorite-limit-reached",function(e){try{let t=e&&e.detail&&e.detail.message||"You can only favorite up to 5 tasks";S(t,{error:!0})}catch{S("You can only favorite up to 5 tasks",{error:!0})}}),document.body.addEventListener("click",function(e){let t=e.target.closest&&e.target.closest(".task-toggle");if(!t||t.classList.contains("favorite-btn"))return;let n=t.closest("tr");if(!n)return;let a=n.classList.toggle("expanded");try{t.setAttribute("aria-expanded",a?"true":"false")}catch{}}),document.body.addEventListener("keydown",function(e){if(e.key!=="Enter"&&e.key!==" "&&e.key!=="Spacebar")return;let t=e.target&&e.target.closest&&e.target.closest(".task-toggle");if(!t||(e.preventDefault(),t.classList.contains("favorite-btn")))return;let n=t.closest("tr");if(!n)return;let a=n.classList.toggle("expanded");try{t.setAttribute("aria-expanded",a?"true":"false")}catch{}}),document.body.addEventListener("htmx:afterSwap",e=>{let t=document.getElementById("sidebar");if(t&&t.classList.contains("active")){let n=document.getElementById("description"),a=document.getElementById("char-count");n&&a&&(a.textContent=n.value.length,n.classList.contains("char-count-listener-added")||(n.addEventListener("input",function(){let c=this.value.length;a.textContent=c,c>90?a.classList.add("text-warning"):a.classList.remove("text-warning"),c>95?a.classList.add("text-danger"):a.classList.remove("text-danger")}),n.classList.add("char-count-listener-added"))),typeof y=="function"&&y()}}),document.body.addEventListener("htmx:afterSwap",function(e){if(e.target&&e.target.id==="task-container")try{E()}catch{}})});})();
