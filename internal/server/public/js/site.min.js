(()=>{window.apiPath=function(m){return"./"+(m.startsWith("/")?m.slice(1):m)};document.addEventListener("DOMContentLoaded",()=>{let m=document.getElementById("sidebar"),N=document.getElementById("openSidebar"),O=document.getElementById("closeSidebar"),q=document.getElementById("description"),v=document.getElementById("char-count"),x=null;(function(){try{let e=document.querySelector("footer");e&&(x=e.outerHTML)}catch{}})();function R(){try{if(!document.querySelector("footer")&&x){let t=document.getElementById("task-container");if(t&&t.parentNode){let e=document.createElement("div");e.innerHTML=x,t.nextSibling?t.parentNode.insertBefore(e.firstElementChild,t.nextSibling):t.parentNode.appendChild(e.firstElementChild)}else{let e=document.createElement("div");e.innerHTML=x,document.body.appendChild(e.firstElementChild)}}}catch{}}q&&v&&q.addEventListener("input",function(){let t=this.value.length;v.textContent=t,t>90?v.classList.add("text-warning"):v.classList.remove("text-warning"),t>95?v.classList.add("text-danger"):v.classList.remove("text-danger")});function w(){let t=document.getElementById("theme-toggle"),n=document.documentElement.getAttribute("data-theme")||localStorage.getItem("theme")||"light";document.documentElement.setAttribute("data-theme",n),n==="dark"?t&&t.classList.add("active"):t&&t.classList.remove("active")}function B(){let e=(document.documentElement.getAttribute("data-theme")||"light")==="light"?"dark":"light",n=document.getElementById("theme-toggle");document.documentElement.setAttribute("data-theme",e),localStorage.setItem("theme",e);try{document.cookie="theme="+e+"; path=/; max-age=31536000; SameSite=Lax"}catch{}e==="dark"?n&&n.classList.add("active"):n&&n.classList.remove("active")}w();let j=document.getElementById("theme-toggle");j&&j.addEventListener("click",B);function M(){m=document.getElementById("sidebar"),m&&m.classList.add("active")}function C(){m=document.getElementById("sidebar"),m&&m.classList.remove("active")}function E(){let t=document.getElementById("openSidebar"),e=document.getElementById("closeSidebar");t&&(t.removeEventListener("click",M),t.addEventListener("click",function(o){try{let a=document.getElementById("newTaskForm");if(a){let c=a.querySelector("#title");c&&(c.value="");let i=a.querySelector("#description");i&&(i.value="");let r=a.querySelector("#project_id");r&&(r.value="");let d=a.querySelector('input[name="id"]');d&&d.remove();let s=a.querySelector('button[type="submit"]');s&&(s.textContent="Add Task");try{a.setAttribute("hx-post",apiPath("/api/add-task"))}catch{}let l=a.querySelector('input[name="currentPage"]');l&&(l.value="1");try{let f=a.querySelector('input[name="project"]'),y=document.querySelector("select#project-filter"),h=y?y.value:"";f||(f=document.createElement("input"),f.type="hidden",f.name="project",a.appendChild(f)),f.value=h}catch{}let u=document.querySelector("#sidebar .sidebar-header h5");u&&(u.textContent="Add Task");let L=document.getElementById("char-count");L&&(L.textContent="0")}}catch{}M()})),e&&(e.removeEventListener("click",C),e.addEventListener("click",C));let n=document.getElementById("theme-toggle");n&&(n.removeEventListener("click",B),n.addEventListener("click",B));try{let o=document.getElementById("newTaskForm");if(o&&!o.classList.contains("task-form-initialized")){try{let a=o.querySelector('input[name="project"]'),c=document.querySelector("select#project-filter"),i=c?c.value:"";a||(a=document.createElement("input"),a.type="hidden",a.name="project",o.appendChild(a)),a.value=i,o.addEventListener("submit",function(){try{let r=document.querySelector("select#project-filter");r&&(a.value=r.value)}catch{}})}catch{}o.addEventListener("htmx:afterRequest",a=>{let c=!1;try{let i=a.detail&&a.detail.xhr,r=i&&i.getResponseHeader?i.getResponseHeader("X-Validation-Error"):null;(r&&r.toLowerCase()==="true"||a.detail&&a.detail.triggerSpec&&a.detail.triggerSpec.trigger==="description-error")&&(c=!0)}catch{}if(a.detail.successful&&!c){C();let i=document.getElementById("title");i&&(i.value="");let r=document.getElementById("description");r&&(r.value="");let d=document.getElementById("char-count");d&&(d.textContent="0");let s=document.getElementById("description-error");s&&(s.innerHTML="")}}),o.classList.add("task-form-initialized")}}catch{}}E(),document.body.addEventListener("htmx:afterSettle",t=>{t.target.id==="task-container"&&(E(),m=document.getElementById("sidebar"),m&&m.classList.contains("htmx-added")&&m.classList.add("active"))});function T(){try{if(typeof Sortable>"u")return;let t=document.getElementById("favorite-task-list"),e=document.getElementById("task-list"),n=(o,a)=>{if(o){if(o._sortable)try{o._sortable.destroy()}catch{}o._sortable=Sortable.create(o,{handle:".drag-handle",animation:150,onEnd:function(c){let i=Array.from(c.to.children).map(s=>(s.id||"").replace("task-","")).filter(Boolean).join(","),r=new URLSearchParams;r.append("order",i),r.append("is_favorite",a?"true":"false");let d=document.querySelector('#task-container [name="currentPage"]');d&&d.value&&r.append("page",d.value);try{let s=document.querySelector("select#project-filter"),l=s?s.value:"";typeof l<"u"&&l!==null&&r.append("project",l)}catch{}fetch(apiPath("/api/reorder-tasks"),{method:"POST",body:r}).then(s=>{if(s.ok)return s.text();throw new Error("Failed to save order")}).then(s=>{let l=document.getElementById("task-container");if(l){l.innerHTML=s;try{typeof htmx<"u"&&htmx.process(l)}catch{}try{T()}catch{}try{typeof E=="function"&&E()}catch{}try{typeof S=="function"&&S()}catch{}try{R()}catch{}}}).catch(s=>{console.error("Reorder failed",s)})}})}};n(t,!0),n(e,!1)}catch{}}T(),document.body.addEventListener("htmx:afterSwap",function(t){if(t.target.id==="task-container"){try{_(),D()}catch{}T()}});function D(){let t=document.getElementById("task-container");if(!t)return;let e=t.querySelector("table");if(!e)return;["table","table-striped","table-bordered","w-100","mb-3"].forEach(o=>{e.classList.contains(o)||e.classList.add(o)})}function _(){let t=document.getElementById("task-container");if(!t||t.querySelector("table"))return;let e=t.querySelector("#favorite-task-list"),n=t.querySelector("#task-list"),o=[];if(e&&o.push(e),n&&o.push(n),o.length===0){let r=Array.from(t.querySelectorAll(":scope > tr"));r.length&&o.push(...r)}if(o.length===0)return;let a=document.createElement("table");a.className="table table-striped table-bordered w-100 mb-3";let c=t.querySelector("thead");if(c){a.appendChild(c.cloneNode(!0));try{c.remove()}catch{}}let i=document.createElement("tbody");o.forEach(r=>{i.appendChild(r)}),a.appendChild(i),t.insertBefore(a,t.firstChild)}let I=document.getElementById("modal");I&&(I.addEventListener("hide.bs.modal",()=>{document.activeElement instanceof HTMLElement&&document.activeElement.blur()}),I.addEventListener("hidden.bs.modal",()=>{I.setAttribute("aria-hidden","true")}));function S(){let t=document.getElementById("modal");if(t){t.classList.contains("modal-listeners-initialized")||(t.addEventListener("hide.bs.modal",()=>{document.activeElement instanceof HTMLElement&&document.activeElement.blur()}),t.addEventListener("hidden.bs.modal",()=>{t.setAttribute("aria-hidden","true")}),t.classList.add("modal-listeners-initialized"));try{typeof bootstrap<"u"&&bootstrap.Modal&&typeof bootstrap.Modal.getOrCreateInstance=="function"&&bootstrap.Modal.getOrCreateInstance(t)}catch{}}}S();function $(t){let e=document.getElementById("changelog-body");if(!e)return;if(!t||!t.length){e.innerHTML='<div class="text-center text-muted">No changelog entries available.</div>';return}let n=document.createElement("div");n.className="changelog-list";let a=t.slice(0,5);if(a.forEach((c,i)=>{let r=document.createElement("div");r.className="card mb-3";let d=document.createElement("div");d.className="card-body";let s=document.createElement("button");s.type="button",s.className="btn btn-link text-start w-100 p-0 d-flex align-items-center",s.style.textDecoration="none";let l=document.createElement("span");l.className="chev me-2",l.textContent="\u25BA",s.appendChild(l);let u=document.createElement("div");u.className="flex-grow-1 text-start";let L=document.createElement("strong");L.textContent=c.title||"",u.appendChild(L);let f=document.createElement("span");f.className="badge releasetag ms-3 "+(c.prerelease?"bg-warning text-dark":"bg-success"),f.textContent=(c.prerelease?"Prerelease":"Release")+" \u2022 "+(c.date||""),u.appendChild(f),s.appendChild(u),d.appendChild(s);let y=document.createElement("div");if(y.id=`changelog-modal-${i}-${Date.now()}`,y.className="collapse mt-2",c.html){let h=document.createElement("div");h.className="changelog-entry-body",h.innerHTML=c.html;try{let p=h.querySelector("h1,h2,h3,h4,h5,h6");if(p){let b=p.querySelector("a");b&&(b.textContent=c.title||b.getAttribute("title")||b.textContent||"")}}catch{}let g=h.firstElementChild;try{if(g&&(g.tagName==="P"||g.tagName==="DIV"||g.tagName==="PRE")){let p=(g.textContent||"").trim().toLowerCase(),b=(c.version||"").toLowerCase(),P=(c.date||"").toLowerCase();(b&&p.includes(b)||P&&p.includes(P)||p.includes(" - "))&&g.remove()}}catch{}y.appendChild(h)}else{let h=document.createElement("ul");Array.isArray(c.notes)&&c.notes.forEach(g=>{let p=document.createElement("li");p.textContent=g,h.appendChild(p)}),y.appendChild(h)}s.addEventListener("click",function(h){h.preventDefault();let g=y.classList.toggle("show");l.textContent=g?"\u25BC":"\u25BA"}),d.appendChild(y),r.appendChild(d),n.appendChild(r)}),t.length>a.length){let c=document.createElement("div");c.className="text-center mt-3";let i=document.createElement("a");i.href=apiPath("/changelog/page"),i.target="_blank",i.textContent="View full changelog",c.appendChild(i),n.appendChild(c)}e.innerHTML="",e.appendChild(n)}function A(){let t=document.getElementById("changelog-body");t&&(t.innerHTML='<div class="text-center text-muted">Loading...</div>'),fetch(apiPath("/changelog")).then(e=>{if(!e.ok)throw new Error("failed to load changelog");return e.json()}).then(e=>{$(e)}).catch(e=>{let n=document.getElementById("changelog-body");n&&(n.innerHTML='<div class="text-danger">Unable to load changelog.</div>'),console.error(e)})}let H=document.getElementById("changelogModal");if(H)try{H.addEventListener("show.bs.modal",A)}catch{let e=document.querySelector('[data-bs-target="#changelogModal"]');e&&e.addEventListener("click",A)}(function(){try{if(!new URLSearchParams(window.location.search).get("cssdebug"))return;let n={"max-420":"(max-width: 420px)","max-600":"(max-width: 600px)","max-768":"(max-width: 768px)","max-1024":"(max-width: 1024px)","pointer-coarse":"(pointer: coarse)","hover-none":"(hover: none)"};console.groupCollapsed("CSS Debug \u2014 media query matches"),Object.entries(n).forEach(([o,a])=>{try{let c=window.matchMedia(a);console.log(a+":",c.matches)}catch{console.log(a+": error")}}),console.log("navigator.maxTouchPoints:",navigator.maxTouchPoints),console.log("ontouchstart in window:","ontouchstart"in window),console.groupEnd()}catch{}})(),document.body.addEventListener("taskDeleted",function(t){let e=document.querySelectorAll("#task-container span"),n=1;for(let c of e){let i=c.textContent.match(/Page\s+(\d+)\s+of\s+(\d+)/);if(i){n=parseInt(i[1]);break}}let o=`/api/fetch-tasks?page=${n}`,a=document.getElementById("search");a&&a.value&&(o+=`&search=${encodeURIComponent(a.value)}`),htmx.ajax("GET",o,{target:"#task-container",swap:"innerHTML"})}),document.body.addEventListener("reloadPage",function(t){let n=`/api/fetch-tasks?page=${t.detail.page||1}`,o=document.getElementById("search");o&&o.value&&(n+=`&search=${encodeURIComponent(o.value)}`),htmx.ajax("GET",n,{target:"#task-container",swap:"innerHTML"})}),document.body.addEventListener("reload-previous-page",function(t){let e=document.querySelectorAll("#task-container span"),n=1;for(let r of e){let d=r.textContent.match(/Page\s+(\d+)\s+of\s+(\d+)/);if(d){n=parseInt(d[1]);break}}let o=Math.max(n-1,1),a=document.getElementById("search"),c=a?a.value:"",i=`/api/fetch-tasks?page=${o}`;c&&(i+=`&search=${encodeURIComponent(c)}`),htmx.ajax("GET",i,{target:"#task-container",swap:"innerHTML"})}),document.body.addEventListener("login-success",function(t){let e=bootstrap.Modal.getInstance(document.getElementById("modal"));e&&e.hide(),window.location.reload()}),document.body.addEventListener("taskCountsChanged",function(t){try{let e=t.detail||{};if(typeof e.completed<"u"){let n=document.getElementById("completed-tasks-badge");n&&(n.textContent=`Completed: ${e.completed}`)}if(typeof e.incomplete<"u"){let n=document.getElementById("incomplete-tasks-badge");n&&(n.textContent=`Incomplete: ${e.incomplete}`)}if(typeof e.completed<"u"&&typeof e.incomplete<"u"){let n=document.getElementById("total-tasks-badge");n&&(n.textContent=`Total Tasks: ${e.completed+e.incomplete}`)}}catch{}});function F(){let t=document.querySelector(".app-toast-container");return t||(t=document.createElement("div"),t.className="app-toast-container",document.body.appendChild(t)),t}function k(t,e){e=e||{};let n=F(),o=document.createElement("div");o.className="app-toast"+(e.error?" app-toast--error":""),o.setAttribute("role","status"),o.setAttribute("aria-live","polite"),o.textContent=t,n.appendChild(o),requestAnimationFrame(()=>{o.classList.add("show")});let a=typeof e.duration=="number"?e.duration:3500,c=()=>{o.classList.remove("show"),setTimeout(()=>{try{o.remove()}catch{}},220)},i=setTimeout(c,a);o.addEventListener("click",function(){clearTimeout(i),c()})}document.body.addEventListener("favorite-limit-reached",function(t){try{let e=t&&t.detail&&t.detail.message||"You can only favorite up to 5 tasks";k(e,{error:!0})}catch{k("You can only favorite up to 5 tasks",{error:!0})}}),document.body.addEventListener("click",function(t){try{if(!(t.target&&t.target.closest&&t.target.closest(".edit-btn")))return;let n=document.getElementById("sidebar");n&&n.classList.add("active")}catch{}}),document.body.addEventListener("click",function(t){try{if(!(t.target&&t.target.closest&&t.target.closest("#closeSidebar")))return;C()}catch{}}),document.body.addEventListener("htmx:afterSwap",t=>{let e=document.getElementById("sidebar");if(e&&e.classList.contains("active")){let n=document.getElementById("description"),o=document.getElementById("char-count");n&&o&&(o.textContent=n.value.length,n.classList.contains("char-count-listener-added")||(n.addEventListener("input",function(){let a=this.value.length;o.textContent=a,a>90?o.classList.add("text-warning"):o.classList.remove("text-warning"),a>95?o.classList.add("text-danger"):o.classList.remove("text-danger")}),n.classList.add("char-count-listener-added"))),typeof w=="function"&&w()}}),document.body.addEventListener("htmx:afterSwap",function(t){try{let e=t.detail&&t.detail.target?t.detail.target:t.target;if(e&&e.id==="sidebar"){try{E()}catch{}let n=document.getElementById("sidebar");n&&n.classList.add("active")}}catch{}}),document.body.addEventListener("htmx:afterSwap",function(t){try{let e=t&&t.detail,n=e&&e.target?e.target:t.target;if(n&&n.id==="sidebar")return;if(n&&n.classList&&n.classList.contains("sidebar-body")){try{E()}catch{}let o=document.getElementById("sidebar");o&&o.classList.add("active")}}catch{}}),document.body.addEventListener("htmx:afterRequest",function(t){try{let e=t&&t.detail&&t.detail.xhr;if(!e||!e.responseURL)return;if(e.responseURL.includes("/api/edit")){let n=e.status||0;if(n>=200&&n<300){try{E()}catch{}let o=document.getElementById("sidebar");o&&o.classList.add("active")}}if(e.responseURL.includes("/api/projects/create")){let n=e.status||0;if(n>=200&&n<300)try{let o=document.getElementById("createProjectForm");if(o){let a=o.querySelector('input[name="name"]');a&&(a.value="")}typeof k=="function"&&k("Project created.")}catch{}}try{if(e&&e.getResponseHeader&&e.getResponseHeader("HX-Trigger")){let n=e.getResponseHeader("HX-Trigger");if(n&&n.indexOf("projects-changed")!==-1&&fetch(apiPath("/api/projects/json")).then(o=>o.json()).then(o=>{try{document.querySelectorAll("select#project_id").forEach(c=>{let i=c.value;for(;c.options.length>1;)c.remove(1);o.forEach(r=>{let d=document.createElement("option");d.value=r.id,d.textContent=r.name,c.appendChild(d)});try{c.value=i}catch{}})}catch{}}).catch(()=>{}),n&&n.indexOf("reset-project-filter")!==-1)try{let o=document.querySelector("select#project-filter");o&&(o.value="",o.dispatchEvent(new Event("change",{bubbles:!0})))}catch{}if(n&&n.indexOf("set-project-filter")!==-1)try{let o=n.match(/set-project-filter:([^\s]+)/);if(o&&o[1]!==void 0){let a=o[1],c=document.querySelector("select#project-filter");c&&(c.value=a)}}catch{}}}catch{}}catch{}}),document.body.addEventListener("htmx:afterSwap",function(t){if(t.target&&t.target.id==="task-container")try{S()}catch{}})});})();
