(()=>{function h(e){return"./"+(e.startsWith("/")?e.slice(1):e)}var I=null;function M(){try{let e=document.querySelector("footer");e&&(I=e.outerHTML)}catch{}}function q(){try{if(!document.querySelector("footer")&&I){let e=document.getElementById("task-container");if(e&&e.parentNode){let t=document.createElement("div");t.innerHTML=I,e.nextSibling?e.parentNode.insertBefore(t.firstElementChild,e.nextSibling):e.parentNode.appendChild(t.firstElementChild)}else{let t=document.createElement("div");t.innerHTML=I,document.body.appendChild(t.firstElementChild)}}}catch{}}function A(){let e=document.querySelector(".app-toast-container");return e||(e=document.createElement("div"),e.className="app-toast-container",document.body.appendChild(e)),e}function H(){let e=document.getElementById("task-container");if(!e)return;let t=e.querySelector("table");if(!t)return;["table","table-striped","table-bordered","w-100","mb-3"].forEach(o=>{t.classList.contains(o)||t.classList.add(o)})}function P(){let e=document.getElementById("task-container");if(!e||e.querySelector("table"))return;let t=e.querySelector("#favorite-task-list"),n=e.querySelector("#task-list"),o=[];if(t&&o.push(t),n&&o.push(n),o.length===0){let c=Array.from(e.querySelectorAll(":scope > tr"));c.length&&o.push(...c)}if(o.length===0)return;let r=document.createElement("table");r.className="table table-striped table-bordered w-100 mb-3";let a=e.querySelector("thead");if(a){r.appendChild(a.cloneNode(!0));try{a.remove()}catch{}}let i=document.createElement("tbody");o.forEach(c=>{i.appendChild(c)}),r.appendChild(i),e.insertBefore(r,e.firstChild)}function S(){let e=document.getElementById("theme-toggle"),n=document.documentElement.getAttribute("data-theme")||localStorage.getItem("theme")||"light";document.documentElement.setAttribute("data-theme",n),n==="dark"?e&&e.classList.add("active"):e&&e.classList.remove("active")}function N(){let t=(document.documentElement.getAttribute("data-theme")||"light")==="light"?"dark":"light",n=document.getElementById("theme-toggle");document.documentElement.setAttribute("data-theme",t),localStorage.setItem("theme",t);try{document.cookie="theme="+t+"; path=/; max-age=31536000; SameSite=Lax"}catch{}t==="dark"?n&&n.classList.add("active"):n&&n.classList.remove("active")}function T(){let e=document.getElementById("theme-toggle");e&&(e.removeEventListener("click",N),e.addEventListener("click",N))}function R(){let e=document.getElementById("description"),t=document.getElementById("char-count");e&&t&&e.addEventListener("input",function(){let r=this.value.length;t.textContent=r,r>90?t.classList.add("text-warning"):t.classList.remove("text-warning"),r>95?t.classList.add("text-danger"):t.classList.remove("text-danger")});let n=document.getElementById("project-name"),o=document.getElementById("project-name-char-count");n&&o&&n.addEventListener("input",function(){let r=this.value.length;o.textContent=r,r>40?o.classList.add("text-warning"):o.classList.remove("text-warning"),r>45?o.classList.add("text-danger"):o.classList.remove("text-danger")})}function w(){let e=document.getElementById("createProjectForm"),t=document.getElementById("project-name"),n=document.getElementById("project-name-error");e&&t&&n&&(t.addEventListener("input",function(){n.innerHTML=""}),e.addEventListener("htmx:afterRequest",function(o){let r=!1;try{let a=o.detail&&o.detail.xhr,i=a&&a.getResponseHeader?a.getResponseHeader("X-Validation-Error"):null;(i&&i.toLowerCase()==="true"||o.detail&&o.detail.triggerSpec&&o.detail.triggerSpec.trigger==="project-name-error")&&(r=!0)}catch{}if(o.detail.successful&&!r){t.value="";let a=document.getElementById("project-name-char-count");a&&(a.textContent="0"),n.innerHTML=""}}))}function D(e){let t=document.getElementById("description");!t||!e||(e.textContent=t.value.length,t.classList.contains("char-count-listener-added")||(t.addEventListener("input",function(){let n=this.value.length;e.textContent=n,n>90?e.classList.add("text-warning"):e.classList.remove("text-warning"),n>95?e.classList.add("text-danger"):e.classList.remove("text-danger")}),t.classList.add("char-count-listener-added")))}function k(){let e=document.getElementById("sidebar");e&&e.classList.add("active")}function L(){let e=document.getElementById("sidebar");e&&e.classList.remove("active")}function y(){let e=document.getElementById("openSidebar"),t=document.getElementById("closeSidebar");e&&(e.removeEventListener("click",k),e.addEventListener("click",function(n){try{let o=document.getElementById("newTaskForm");if(o){let r=o.querySelector("#title");r&&(r.value="");let a=o.querySelector("#description");a&&(a.value="");let i=o.querySelector("#project_id");i&&(i.value="");let c=o.querySelector("#due_date");c&&(c.value="");let d=o.querySelector('input[name="id"]');d&&d.remove();let s=o.querySelector('button[type="submit"]');s&&(s.textContent="Add Task");try{o.setAttribute("hx-post",h("/api/add-task"))}catch{}let l=o.querySelector('input[name="currentPage"]');l&&(l.value="1");try{let m=o.querySelector('input[name="project"]'),E=document.querySelector("select#project-filter"),f=E?E.value:"";m||(m=document.createElement("input"),m.type="hidden",m.name="project",o.appendChild(m)),m.value=f}catch{}let u=document.querySelector("#sidebar .sidebar-header h5");u&&(u.textContent="Add Task");let C=document.getElementById("char-count");C&&(C.textContent="0")}}catch{}k()})),t&&(t.removeEventListener("click",L),t.addEventListener("click",L)),T();try{let n=document.getElementById("newTaskForm");if(n&&!n.classList.contains("task-form-initialized")){try{let o=n.querySelector('input[name="project"]'),r=document.querySelector("select#project-filter"),a=r?r.value:"";o||(o=document.createElement("input"),o.type="hidden",o.name="project",n.appendChild(o)),o.value=a,n.addEventListener("submit",function(){try{let i=document.querySelector("select#project-filter");i&&(o.value=i.value)}catch{}})}catch{}n.addEventListener("htmx:afterRequest",o=>{let r=!1;try{let a=o.detail&&o.detail.xhr,i=a&&a.getResponseHeader?a.getResponseHeader("X-Validation-Error"):null;(i&&i.toLowerCase()==="true"||o.detail&&o.detail.triggerSpec&&o.detail.triggerSpec.trigger==="description-error")&&(r=!0)}catch{}if(o.detail.successful&&!r){L();let a=document.getElementById("title");a&&(a.value="");let i=document.getElementById("description");i&&(i.value="");let c=document.getElementById("char-count");c&&(c.textContent="0");let d=document.getElementById("description-error");d&&(d.innerHTML="")}}),n.classList.add("task-form-initialized")}}catch{}}function _(){document.body.removeEventListener("click",F),document.body.addEventListener("click",F)}function F(e){try{if(!(e.target&&e.target.closest&&e.target.closest(".edit-btn")))return;let n=document.getElementById("sidebar");n&&n.classList.add("active")}catch{}}function V(){document.body.removeEventListener("click",z),document.body.addEventListener("click",z)}function z(e){try{if(!(e.target&&e.target.closest&&e.target.closest("#closeSidebar")))return;L()}catch{}}function O(){document.body.removeEventListener("htmx:afterSwap",$),document.body.addEventListener("htmx:afterSwap",$)}function $(e){let t=document.getElementById("sidebar");if(t&&t.classList.contains("active")){let n=document.getElementById("description"),o=document.getElementById("char-count");n&&o&&D(o),typeof S=="function"&&S()}}function v(){let e=document.getElementById("modal");if(e){e.classList.contains("modal-listeners-initialized")||(e.addEventListener("hide.bs.modal",()=>{document.activeElement instanceof HTMLElement&&document.activeElement.blur()}),e.addEventListener("hidden.bs.modal",()=>{e.setAttribute("aria-hidden","true")}),e.classList.add("modal-listeners-initialized"));try{typeof bootstrap<"u"&&bootstrap.Modal&&typeof bootstrap.Modal.getOrCreateInstance=="function"&&bootstrap.Modal.getOrCreateInstance(e)}catch{}}}function K(e){let t=document.getElementById("changelog-body");if(!t)return;if(!e||!e.length){t.innerHTML='<div class="text-center text-muted">No changelog entries available.</div>';return}let n=document.createElement("div");n.className="changelog-list";let r=e.slice(0,5);if(r.forEach((a,i)=>{let c=document.createElement("div");c.className="card mb-3";let d=document.createElement("div");d.className="card-body";let s=document.createElement("button");s.type="button",s.className="btn btn-link text-start w-100 p-0 d-flex align-items-center",s.style.textDecoration="none";let l=document.createElement("span");l.className="chev me-2",l.textContent="\u25BA",s.appendChild(l);let u=document.createElement("div");u.className="flex-grow-1 text-start";let C=document.createElement("strong");C.textContent=a.title||"",u.appendChild(C);let m=document.createElement("span");m.className="badge releasetag ms-3 "+(a.prerelease?"bg-warning text-dark":"bg-success"),m.textContent=(a.prerelease?"Prerelease":"Release")+" \u2022 "+(a.date||""),u.appendChild(m),s.appendChild(u),d.appendChild(s);let E=document.createElement("div");if(E.id=`changelog-modal-${i}-${Date.now()}`,E.className="collapse mt-2",a.html){let f=document.createElement("div");f.className="changelog-entry-body",f.innerHTML=a.html;try{let p=f.querySelector("h1,h2,h3,h4,h5,h6");if(p){let b=p.querySelector("a");b&&(b.textContent=a.title||b.getAttribute("title")||b.textContent||"")}}catch{}let g=f.firstElementChild;try{if(g&&(g.tagName==="P"||g.tagName==="DIV"||g.tagName==="PRE")){let p=(g.textContent||"").trim().toLowerCase(),b=(a.version||"").toLowerCase(),j=(a.date||"").toLowerCase();(b&&p.includes(b)||j&&p.includes(j)||p.includes(" - "))&&g.remove()}}catch{}E.appendChild(f)}else{let f=document.createElement("ul");Array.isArray(a.notes)&&a.notes.forEach(g=>{let p=document.createElement("li");p.textContent=g,f.appendChild(p)}),E.appendChild(f)}s.addEventListener("click",function(f){f.preventDefault();let g=E.classList.toggle("show");l.textContent=g?"\u25BC":"\u25BA"}),d.appendChild(E),c.appendChild(d),n.appendChild(c)}),e.length>r.length){let a=document.createElement("div");a.className="text-center mt-3";let i=document.createElement("a");i.href=h("/changelog/page"),i.textContent="View full changelog",a.appendChild(i),n.appendChild(a)}t.innerHTML="",t.appendChild(n)}function U(){let e=document.getElementById("changelog-body");e&&(e.innerHTML='<div class="text-center text-muted">Loading...</div>'),fetch(h("/changelog")).then(t=>{if(!t.ok)throw new Error("failed to load changelog");return t.json()}).then(t=>{K(t)}).catch(t=>{let n=document.getElementById("changelog-body");n&&(n.innerHTML='<div class="text-danger">Unable to load changelog.</div>'),console.error(t)})}function X(){let e=document.getElementById("changelogModal");if(e)try{e.addEventListener("show.bs.modal",U)}catch{let n=document.querySelector('[data-bs-target="#changelogModal"]');n&&n.addEventListener("click",U)}}function B(){try{if(typeof Sortable>"u")return;let e=document.getElementById("favorite-task-list"),t=document.getElementById("task-list"),n=(o,r)=>{if(o){if(o._sortable)try{o._sortable.destroy()}catch{}o._sortable=Sortable.create(o,{handle:".drag-handle",animation:150,onEnd:function(a){let i=Array.from(a.to.children).map(s=>(s.id||"").replace("task-","")).filter(Boolean).join(","),c=new URLSearchParams;c.append("order",i),c.append("is_favorite",r?"true":"false");let d=document.querySelector('#task-container [name="currentPage"]');d&&d.value&&c.append("page",d.value);try{let s=document.querySelector("select#project-filter"),l=s?s.value:"";typeof l<"u"&&l!==null&&c.append("project",l)}catch{}fetch(h("/api/reorder-tasks"),{method:"POST",body:c}).then(s=>{if(s.ok)return s.text();throw new Error("Failed to save order")}).then(s=>{let l=document.getElementById("task-container");if(l){l.innerHTML=s;try{typeof htmx<"u"&&htmx.process(l)}catch{}try{B()}catch{}try{typeof y=="function"&&y()}catch{}try{typeof v=="function"&&v()}catch{}try{q()}catch{}}}).catch(s=>{console.error("Reorder failed",s)})}})}};n(e,!0),n(t,!1)}catch{}}function G(){B(),document.body.addEventListener("htmx:afterSwap",function(e){if(e.target.id==="task-container"){try{P(),H()}catch{}B()}})}function x(e,t){t=t||{};let n=A(),o=document.createElement("div");o.className="app-toast"+(t.error?" app-toast--error":""),o.setAttribute("role","status"),o.setAttribute("aria-live","polite"),o.textContent=e,n.appendChild(o),requestAnimationFrame(()=>{o.classList.add("show")});let r=typeof t.duration=="number"?t.duration:3500,a=()=>{o.classList.remove("show"),setTimeout(()=>{try{o.remove()}catch{}},220)},i=setTimeout(a,r);o.addEventListener("click",function(){clearTimeout(i),a()})}function W(){document.body.addEventListener("favorite-limit-reached",function(e){try{let t=e&&e.detail&&e.detail.message||"You can only favorite up to 5 tasks";x(t,{error:!0})}catch{x("You can only favorite up to 5 tasks",{error:!0})}})}function Z(){document.body.addEventListener("taskDeleted",function(e){let t=document.querySelectorAll("#task-container span"),n=1;for(let a of t){let i=a.textContent.match(/Page\s+(\d+)\s+of\s+(\d+)/);if(i){n=parseInt(i[1]);break}}let o=`/api/fetch-tasks?page=${n}`,r=document.getElementById("search");r&&r.value&&(o+=`&search=${encodeURIComponent(r.value)}`),htmx.ajax("GET",o,{target:"#task-container",swap:"innerHTML"})})}function ee(){document.body.addEventListener("reloadPage",function(e){let n=`/api/fetch-tasks?page=${e.detail.page||1}`,o=document.getElementById("search");o&&o.value&&(n+=`&search=${encodeURIComponent(o.value)}`),htmx.ajax("GET",n,{target:"#task-container",swap:"innerHTML"})})}function te(){document.body.addEventListener("reload-previous-page",function(e){let t=document.querySelectorAll("#task-container span"),n=1;for(let c of t){let d=c.textContent.match(/Page\s+(\d+)\s+of\s+(\d+)/);if(d){n=parseInt(d[1]);break}}let o=Math.max(n-1,1),r=document.getElementById("search"),a=r?r.value:"",i=`/api/fetch-tasks?page=${o}`;a&&(i+=`&search=${encodeURIComponent(a)}`),htmx.ajax("GET",i,{target:"#task-container",swap:"innerHTML"})})}function ne(){document.body.addEventListener("login-success",function(e){let t=bootstrap.Modal.getInstance(document.getElementById("modal"));t&&t.hide(),window.location.reload()})}function oe(){document.body.addEventListener("taskCountsChanged",function(e){try{let t=e.detail||{};if(typeof t.completed<"u"){let n=document.getElementById("completed-tasks-badge");n&&(n.textContent=`Completed: ${t.completed}`)}if(typeof t.incomplete<"u"){let n=document.getElementById("incomplete-tasks-badge");n&&(n.textContent=`Incomplete: ${t.incomplete}`)}if(typeof t.completed<"u"&&typeof t.incomplete<"u"){let n=document.getElementById("total-tasks-badge");n&&(n.textContent=`Total Tasks: ${t.completed+t.incomplete}`)}}catch{}})}function ae(){document.body.addEventListener("htmx:afterRequest",function(e){try{let t=e&&e.detail&&e.detail.xhr;if(!t||!t.responseURL)return;if(t.responseURL.includes("/api/edit")){let n=t.status||0;if(n>=200&&n<300){try{y()}catch{}let o=document.getElementById("sidebar");o&&o.classList.add("active")}}if(t.responseURL.includes("/api/projects/create")){let n=t.status||0,o=t.getResponseHeader&&t.getResponseHeader("X-Validation-Error")==="true";if(n>=200&&n<300&&!o)try{let r=document.getElementById("createProjectForm");if(r){let a=r.querySelector('input[name="name"]');a&&(a.value="");let i=document.getElementById("project-name-char-count");i&&(i.textContent="0");let c=document.getElementById("project-name-error");c&&(c.innerHTML="")}w(),typeof x=="function"&&x("Project created.")}catch{}}try{if(t&&t.getResponseHeader&&t.getResponseHeader("HX-Trigger")){let n=t.getResponseHeader("HX-Trigger");if(n&&n.indexOf("projects-changed")!==-1&&fetch(h("/api/projects/json")).then(o=>o.json()).then(o=>{try{document.querySelectorAll("select#project_id").forEach(a=>{let i=a.value;for(;a.options.length>1;)a.remove(1);o.forEach(c=>{let d=document.createElement("option");d.value=c.id,d.textContent=c.name,a.appendChild(d)});try{a.value=i}catch{}})}catch{}}).catch(()=>{}),n&&n.indexOf("reset-project-filter")!==-1)try{let o=document.querySelector("select#project-filter");o&&(o.value="",o.dispatchEvent(new Event("change",{bubbles:!0})))}catch{}if(n&&n.indexOf("set-project-filter")!==-1)try{let o=n.match(/set-project-filter:([^\s]+)/);if(o&&o[1]!==void 0){let r=o[1],a=document.querySelector("select#project-filter");a&&(a.value=r)}}catch{}}}catch{}}catch{}})}function re(){document.body.addEventListener("htmx:afterSettle",e=>{if(e.target.id==="task-container"){y();let t=document.getElementById("sidebar");t&&t.classList.contains("htmx-added")&&t.classList.add("active")}})}function ie(){O(),document.body.addEventListener("htmx:afterSwap",function(e){try{let t=e.detail&&e.detail.target?e.detail.target:e.target;if(t&&t.id==="sidebar"){try{y()}catch{}let n=document.getElementById("sidebar");n&&n.classList.add("active")}}catch{}}),document.body.addEventListener("htmx:afterSwap",function(e){try{let t=e&&e.detail,n=t&&t.target?t.target:e.target;if(n&&n.id==="sidebar")return;if(n&&n.classList&&n.classList.contains("sidebar-body")){try{y()}catch{}let o=document.getElementById("sidebar");o&&o.classList.add("active")}}catch{}}),document.body.addEventListener("htmx:afterSwap",function(e){if(e.target&&e.target.id==="task-container")try{v()}catch{}})}function Y(){Z(),ee(),te(),ne(),oe(),ae(),re(),ie(),_(),V()}function ce(e){let n=`; ${document.cookie}`.split(`; ${e}=`);return n.length===2?n.pop().split(";").shift():null}function se(e,t,n){let o=new Date;o.setTime(o.getTime()+n*24*60*60*1e3);let r=`expires=${o.toUTCString()}`;document.cookie=`${e}=${t};${r};path=/;SameSite=Lax`}function de(){let e=document.getElementById("global-announcement");e&&(e.classList.remove("show"),e.classList.add("fade-out"),setTimeout(()=>{e.remove()},300),se("announcement_dismissed","true",30))}function Q(){let e=document.getElementById("global-announcement");if(e){ce("announcement_dismissed")==="true"&&(e.style.display="none");let n=e.querySelector(".btn-close");n&&n.addEventListener("click",de)}}function J(){let e=document.getElementById("global_announcement_text"),t=document.getElementById("announcement-char-count");e&&t&&(e.addEventListener("input",function(){let n=this.value.length;t.textContent=n,n>450?t.classList.add("text-warning"):t.classList.remove("text-warning"),n>480?t.classList.add("text-danger"):t.classList.remove("text-danger")}),e.addEventListener("input",function(){let n=document.getElementById("announcement-text-error");n&&(n.innerHTML="")}))}window.apiPath=h;window.showToast=x;window.closeSidebar=L;window.openSidebar=k;document.addEventListener("DOMContentLoaded",()=>{M(),S(),T(),R(),w(),y(),G(),v(),X(),W(),Y(),Q(),J(),function(){try{if(!new URLSearchParams(window.location.search).get("cssdebug"))return;let n={"max-420":"(max-width: 420px)","max-600":"(max-width: 600px)","max-768":"(max-width: 768px)","max-1024":"(max-width: 1024px)","pointer-coarse":"(pointer: coarse)","hover-none":"(hover: none)"};console.groupCollapsed("CSS Debug \u2014 media query matches"),Object.entries(n).forEach(([o,r])=>{try{let a=window.matchMedia(r);console.log(r+":",a.matches)}catch{console.log(r+": error")}}),console.log("navigator.maxTouchPoints:",navigator.maxTouchPoints),console.log("ontouchstart in window:","ontouchstart"in window),console.groupEnd()}catch{}}()});})();
