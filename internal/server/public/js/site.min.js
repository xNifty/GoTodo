(()=>{window.apiPath=function(i){return"./"+(i.startsWith("/")?i.slice(1):i)};document.addEventListener("DOMContentLoaded",()=>{let i=document.getElementById("sidebar"),w=document.getElementById("openSidebar"),q=document.getElementById("closeSidebar"),x=document.getElementById("description"),l=document.getElementById("char-count"),u=null;(function(){try{let t=document.querySelector("footer");t&&(u=t.outerHTML)}catch{}})();function C(){try{if(!document.querySelector("footer")&&u){let e=document.getElementById("task-container");if(e&&e.parentNode){let t=document.createElement("div");t.innerHTML=u,e.nextSibling?e.parentNode.insertBefore(t.firstElementChild,e.nextSibling):e.parentNode.appendChild(t.firstElementChild)}else{let t=document.createElement("div");t.innerHTML=u,document.body.appendChild(t.firstElementChild)}}}catch{}}x&&l&&x.addEventListener("input",function(){let e=this.value.length;l.textContent=e,e>90?l.classList.add("text-warning"):l.classList.remove("text-warning"),e>95?l.classList.add("text-danger"):l.classList.remove("text-danger")});function E(){let e=document.getElementById("theme-toggle"),n=document.documentElement.getAttribute("data-theme")||localStorage.getItem("theme")||"light";document.documentElement.setAttribute("data-theme",n),n==="dark"?e&&e.classList.add("active"):e&&e.classList.remove("active")}function b(){let t=(document.documentElement.getAttribute("data-theme")||"light")==="light"?"dark":"light",n=document.getElementById("theme-toggle");document.documentElement.setAttribute("data-theme",t),localStorage.setItem("theme",t);try{document.cookie="theme="+t+"; path=/; max-age=31536000; SameSite=Lax"}catch{}t==="dark"?n&&n.classList.add("active"):n&&n.classList.remove("active")}E();let k=document.getElementById("theme-toggle");k&&k.addEventListener("click",b);function I(){i=document.getElementById("sidebar"),i&&i.classList.add("active")}function v(){i=document.getElementById("sidebar"),i&&i.classList.remove("active")}function f(){let e=document.getElementById("openSidebar"),t=document.getElementById("closeSidebar");e&&(e.removeEventListener("click",I),e.addEventListener("click",I)),t&&(t.removeEventListener("click",v),t.addEventListener("click",v));let n=document.getElementById("theme-toggle");n&&(n.removeEventListener("click",b),n.addEventListener("click",b))}f(),document.body.addEventListener("htmx:afterSettle",e=>{e.target.id==="task-container"&&(f(),i=document.getElementById("sidebar"),i&&i.classList.contains("htmx-added")&&i.classList.add("active"))});function L(){try{if(typeof Sortable>"u")return;let e=document.getElementById("favorite-task-list"),t=document.getElementById("task-list"),n=(o,a)=>{if(o){if(o._sortable)try{o._sortable.destroy()}catch{}o._sortable=Sortable.create(o,{handle:".drag-handle",animation:150,onEnd:function(r){let s=Array.from(r.to.children).map(d=>(d.id||"").replace("task-","")).filter(Boolean).join(","),c=new URLSearchParams;c.append("order",s),c.append("is_favorite",a?"true":"false");let m=document.querySelector('#task-container [name="currentPage"]');m&&m.value&&c.append("page",m.value),fetch("/api/reorder-tasks",{method:"POST",body:c}).then(d=>{if(d.ok)return d.text();throw new Error("Failed to save order")}).then(d=>{let p=document.getElementById("task-container");if(p){p.innerHTML=d;try{typeof htmx<"u"&&htmx.process(p)}catch{}try{L()}catch{}try{typeof f=="function"&&f()}catch{}try{typeof h=="function"&&h()}catch{}try{C()}catch{}}}).catch(d=>{console.error("Reorder failed",d)})}})}};n(e,!0),n(t,!1)}catch{}}L(),document.body.addEventListener("htmx:afterSwap",function(e){if(e.target.id==="task-container"){try{M(),T()}catch{}L()}});function T(){let e=document.getElementById("task-container");if(!e)return;let t=e.querySelector("table");if(!t)return;["table","table-striped","table-bordered","w-100","mb-3"].forEach(o=>{t.classList.contains(o)||t.classList.add(o)})}function M(){let e=document.getElementById("task-container");if(!e||e.querySelector("table"))return;let t=e.querySelector("#favorite-task-list"),n=e.querySelector("#task-list"),o=[];if(t&&o.push(t),n&&o.push(n),o.length===0){let c=Array.from(e.querySelectorAll(":scope > tr"));c.length&&o.push(...c)}if(o.length===0)return;let a=document.createElement("table");a.className="table table-striped table-bordered w-100 mb-3";let r=e.querySelector("thead");if(r){a.appendChild(r.cloneNode(!0));try{r.remove()}catch{}}let s=document.createElement("tbody");o.forEach(c=>{s.appendChild(c)}),a.appendChild(s),e.insertBefore(a,e.firstChild)}let B=document.getElementById("newTaskForm");B&&B.addEventListener("htmx:afterRequest",e=>{let t=!1;try{let n=e.detail&&e.detail.xhr,o=n&&n.getResponseHeader?n.getResponseHeader("X-Validation-Error"):null;(o&&o.toLowerCase()==="true"||e.detail&&e.detail.triggerSpec&&e.detail.triggerSpec.trigger==="description-error")&&(t=!0)}catch{}if(e.detail.successful&&!t){v();let n=document.getElementById("title");n&&(n.value="");let o=document.getElementById("description");o&&(o.value="");let a=document.getElementById("char-count");a&&(a.textContent="0");let r=document.getElementById("description-error");r&&(r.innerHTML="")}else if(t)return});let g=document.getElementById("modal");g&&(g.addEventListener("hide.bs.modal",()=>{document.activeElement instanceof HTMLElement&&document.activeElement.blur()}),g.addEventListener("hidden.bs.modal",()=>{g.setAttribute("aria-hidden","true")}));function h(){let e=document.getElementById("modal");if(e){e.classList.contains("modal-listeners-initialized")||(e.addEventListener("hide.bs.modal",()=>{document.activeElement instanceof HTMLElement&&document.activeElement.blur()}),e.addEventListener("hidden.bs.modal",()=>{e.setAttribute("aria-hidden","true")}),e.classList.add("modal-listeners-initialized"));try{typeof bootstrap<"u"&&bootstrap.Modal&&typeof bootstrap.Modal.getOrCreateInstance=="function"&&bootstrap.Modal.getOrCreateInstance(e)}catch{}}}h(),function(){try{if(!new URLSearchParams(window.location.search).get("cssdebug"))return;let n={"max-420":"(max-width: 420px)","max-600":"(max-width: 600px)","max-768":"(max-width: 768px)","max-1024":"(max-width: 1024px)","pointer-coarse":"(pointer: coarse)","hover-none":"(hover: none)"};console.groupCollapsed("CSS Debug \u2014 media query matches"),Object.entries(n).forEach(([o,a])=>{try{let r=window.matchMedia(a);console.log(a+":",r.matches)}catch{console.log(a+": error")}}),console.log("navigator.maxTouchPoints:",navigator.maxTouchPoints),console.log("ontouchstart in window:","ontouchstart"in window),console.groupEnd()}catch{}}(),document.body.addEventListener("taskDeleted",function(e){let t=document.querySelectorAll("#task-container span"),n=1;for(let r of t){let s=r.textContent.match(/Page\s+(\d+)\s+of\s+(\d+)/);if(s){n=parseInt(s[1]);break}}let o=`/api/fetch-tasks?page=${n}`,a=document.getElementById("search");a&&a.value&&(o+=`&search=${encodeURIComponent(a.value)}`),htmx.ajax("GET",o,{target:"#task-container",swap:"innerHTML"})}),document.body.addEventListener("reloadPage",function(e){let n=`/api/fetch-tasks?page=${e.detail.page||1}`,o=document.getElementById("search");o&&o.value&&(n+=`&search=${encodeURIComponent(o.value)}`),htmx.ajax("GET",n,{target:"#task-container",swap:"innerHTML"})}),document.body.addEventListener("reload-previous-page",function(e){let t=document.querySelectorAll("#task-container span"),n=1;for(let c of t){let m=c.textContent.match(/Page\s+(\d+)\s+of\s+(\d+)/);if(m){n=parseInt(m[1]);break}}let o=Math.max(n-1,1),a=document.getElementById("search"),r=a?a.value:"",s=`/api/fetch-tasks?page=${o}`;r&&(s+=`&search=${encodeURIComponent(r)}`),htmx.ajax("GET",s,{target:"#task-container",swap:"innerHTML"})}),document.body.addEventListener("login-success",function(e){let t=bootstrap.Modal.getInstance(document.getElementById("modal"));t&&t.hide(),window.location.reload()}),document.body.addEventListener("taskCountsChanged",function(e){try{let t=e.detail||{};if(typeof t.completed<"u"){let n=document.getElementById("completed-tasks-badge");n&&(n.textContent=`Completed: ${t.completed}`)}if(typeof t.incomplete<"u"){let n=document.getElementById("incomplete-tasks-badge");n&&(n.textContent=`Incomplete: ${t.incomplete}`)}if(typeof t.completed<"u"&&typeof t.incomplete<"u"){let n=document.getElementById("total-tasks-badge");n&&(n.textContent=`Total Tasks: ${t.completed+t.incomplete}`)}}catch{}});function A(){let e=document.querySelector(".app-toast-container");return e||(e=document.createElement("div"),e.className="app-toast-container",document.body.appendChild(e)),e}function S(e,t){t=t||{};let n=A(),o=document.createElement("div");o.className="app-toast"+(t.error?" app-toast--error":""),o.setAttribute("role","status"),o.setAttribute("aria-live","polite"),o.textContent=e,n.appendChild(o),requestAnimationFrame(()=>{o.classList.add("show")});let a=typeof t.duration=="number"?t.duration:3500,r=()=>{o.classList.remove("show"),setTimeout(()=>{try{o.remove()}catch{}},220)},s=setTimeout(r,a);o.addEventListener("click",function(){clearTimeout(s),r()})}document.body.addEventListener("favorite-limit-reached",function(e){try{let t=e&&e.detail&&e.detail.message||"You can only favorite up to 5 tasks";S(t,{error:!0})}catch{S("You can only favorite up to 5 tasks",{error:!0})}}),document.body.addEventListener("click",function(e){let t=e.target.closest&&e.target.closest(".task-toggle");if(!t||t.classList.contains("favorite-btn"))return;let n=t.closest("tr");if(!n)return;let o=n.classList.toggle("expanded");try{t.setAttribute("aria-expanded",o?"true":"false")}catch{}}),document.body.addEventListener("keydown",function(e){if(e.key!=="Enter"&&e.key!==" "&&e.key!=="Spacebar")return;let t=e.target&&e.target.closest&&e.target.closest(".task-toggle");if(!t||(e.preventDefault(),t.classList.contains("favorite-btn")))return;let n=t.closest("tr");if(!n)return;let o=n.classList.toggle("expanded");try{t.setAttribute("aria-expanded",o?"true":"false")}catch{}}),document.body.addEventListener("htmx:afterSwap",e=>{let t=document.getElementById("sidebar");if(t&&t.classList.contains("active")){let n=document.getElementById("description"),o=document.getElementById("char-count");n&&o&&(o.textContent=n.value.length,n.classList.contains("char-count-listener-added")||(n.addEventListener("input",function(){let a=this.value.length;o.textContent=a,a>90?o.classList.add("text-warning"):o.classList.remove("text-warning"),a>95?o.classList.add("text-danger"):o.classList.remove("text-danger")}),n.classList.add("char-count-listener-added"))),typeof E=="function"&&E()}}),document.body.addEventListener("htmx:afterSwap",function(e){if(e.target&&e.target.id==="task-container")try{h()}catch{}})});})();
