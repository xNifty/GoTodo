(()=>{window.apiPath=function(d){return"./"+(d.startsWith("/")?d.slice(1):d)};document.addEventListener("DOMContentLoaded",()=>{let d=document.getElementById("sidebar"),R=document.getElementById("openSidebar"),U=document.getElementById("closeSidebar"),S=document.getElementById("description"),y=document.getElementById("char-count"),b=null;(function(){try{let t=document.querySelector("footer");t&&(b=t.outerHTML)}catch{}})();function $(){try{if(!document.querySelector("footer")&&b){let e=document.getElementById("task-container");if(e&&e.parentNode){let t=document.createElement("div");t.innerHTML=b,e.nextSibling?e.parentNode.insertBefore(t.firstElementChild,e.nextSibling):e.parentNode.appendChild(t.firstElementChild)}else{let t=document.createElement("div");t.innerHTML=b,document.body.appendChild(t.firstElementChild)}}}catch{}}S&&y&&S.addEventListener("input",function(){let e=this.value.length;y.textContent=e,e>90?y.classList.add("text-warning"):y.classList.remove("text-warning"),e>95?y.classList.add("text-danger"):y.classList.remove("text-danger")});function C(){let e=document.getElementById("theme-toggle"),n=document.documentElement.getAttribute("data-theme")||localStorage.getItem("theme")||"light";document.documentElement.setAttribute("data-theme",n),n==="dark"?e&&e.classList.add("active"):e&&e.classList.remove("active")}function k(){let t=(document.documentElement.getAttribute("data-theme")||"light")==="light"?"dark":"light",n=document.getElementById("theme-toggle");document.documentElement.setAttribute("data-theme",t),localStorage.setItem("theme",t);try{document.cookie="theme="+t+"; path=/; max-age=31536000; SameSite=Lax"}catch{}t==="dark"?n&&n.classList.add("active"):n&&n.classList.remove("active")}C();let T=document.getElementById("theme-toggle");T&&T.addEventListener("click",k);function M(){d=document.getElementById("sidebar"),d&&d.classList.add("active")}function I(){d=document.getElementById("sidebar"),d&&d.classList.remove("active")}function v(){let e=document.getElementById("openSidebar"),t=document.getElementById("closeSidebar");e&&(e.removeEventListener("click",M),e.addEventListener("click",M)),t&&(t.removeEventListener("click",I),t.addEventListener("click",I));let n=document.getElementById("theme-toggle");n&&(n.removeEventListener("click",k),n.addEventListener("click",k))}v(),document.body.addEventListener("htmx:afterSettle",e=>{e.target.id==="task-container"&&(v(),d=document.getElementById("sidebar"),d&&d.classList.contains("htmx-added")&&d.classList.add("active"))});function w(){try{if(typeof Sortable>"u")return;let e=document.getElementById("favorite-task-list"),t=document.getElementById("task-list"),n=(a,c)=>{if(a){if(a._sortable)try{a._sortable.destroy()}catch{}a._sortable=Sortable.create(a,{handle:".drag-handle",animation:150,onEnd:function(o){let r=Array.from(o.to.children).map(i=>(i.id||"").replace("task-","")).filter(Boolean).join(","),s=new URLSearchParams;s.append("order",r),s.append("is_favorite",c?"true":"false");let l=document.querySelector('#task-container [name="currentPage"]');l&&l.value&&s.append("page",l.value),fetch("/api/reorder-tasks",{method:"POST",body:s}).then(i=>{if(i.ok)return i.text();throw new Error("Failed to save order")}).then(i=>{let h=document.getElementById("task-container");if(h){h.innerHTML=i;try{typeof htmx<"u"&&htmx.process(h)}catch{}try{w()}catch{}try{typeof v=="function"&&v()}catch{}try{typeof x=="function"&&x()}catch{}try{$()}catch{}}}).catch(i=>{console.error("Reorder failed",i)})}})}};n(e,!0),n(t,!1)}catch{}}w(),document.body.addEventListener("htmx:afterSwap",function(e){if(e.target.id==="task-container"){try{F(),_()}catch{}w()}});function _(){let e=document.getElementById("task-container");if(!e)return;let t=e.querySelector("table");if(!t)return;["table","table-striped","table-bordered","w-100","mb-3"].forEach(a=>{t.classList.contains(a)||t.classList.add(a)})}function F(){let e=document.getElementById("task-container");if(!e||e.querySelector("table"))return;let t=e.querySelector("#favorite-task-list"),n=e.querySelector("#task-list"),a=[];if(t&&a.push(t),n&&a.push(n),a.length===0){let s=Array.from(e.querySelectorAll(":scope > tr"));s.length&&a.push(...s)}if(a.length===0)return;let c=document.createElement("table");c.className="table table-striped table-bordered w-100 mb-3";let o=e.querySelector("thead");if(o){c.appendChild(o.cloneNode(!0));try{o.remove()}catch{}}let r=document.createElement("tbody");a.forEach(s=>{r.appendChild(s)}),c.appendChild(r),e.insertBefore(c,e.firstChild)}let A=document.getElementById("newTaskForm");A&&A.addEventListener("htmx:afterRequest",e=>{let t=!1;try{let n=e.detail&&e.detail.xhr,a=n&&n.getResponseHeader?n.getResponseHeader("X-Validation-Error"):null;(a&&a.toLowerCase()==="true"||e.detail&&e.detail.triggerSpec&&e.detail.triggerSpec.trigger==="description-error")&&(t=!0)}catch{}if(e.detail.successful&&!t){I();let n=document.getElementById("title");n&&(n.value="");let a=document.getElementById("description");a&&(a.value="");let c=document.getElementById("char-count");c&&(c.textContent="0");let o=document.getElementById("description-error");o&&(o.innerHTML="")}else if(t)return});let L=document.getElementById("modal");L&&(L.addEventListener("hide.bs.modal",()=>{document.activeElement instanceof HTMLElement&&document.activeElement.blur()}),L.addEventListener("hidden.bs.modal",()=>{L.setAttribute("aria-hidden","true")}));function x(){let e=document.getElementById("modal");if(e){e.classList.contains("modal-listeners-initialized")||(e.addEventListener("hide.bs.modal",()=>{document.activeElement instanceof HTMLElement&&document.activeElement.blur()}),e.addEventListener("hidden.bs.modal",()=>{e.setAttribute("aria-hidden","true")}),e.classList.add("modal-listeners-initialized"));try{typeof bootstrap<"u"&&bootstrap.Modal&&typeof bootstrap.Modal.getOrCreateInstance=="function"&&bootstrap.Modal.getOrCreateInstance(e)}catch{}}}x();function O(e){let t=document.getElementById("changelog-body");if(!t)return;if(!e||!e.length){t.innerHTML='<div class="text-center text-muted">No changelog entries available.</div>';return}let n=document.createElement("div");n.className="changelog-list";let c=e.slice(0,5);if(c.forEach((o,r)=>{let s=document.createElement("div");s.className="card mb-3";let l=document.createElement("div");l.className="card-body";let i=document.createElement("button");i.type="button",i.className="btn btn-link text-start w-100 p-0 d-flex align-items-center",i.style.textDecoration="none";let h=document.createElement("span");h.className="chev me-2",h.textContent="\u25BA",i.appendChild(h);let f=document.createElement("div");f.className="flex-grow-1 text-start";let q=document.createElement("strong");q.textContent=o.title||"",f.appendChild(q);let B=document.createElement("span");B.className="badge releasetag ms-3 "+(o.prerelease?"bg-warning text-dark":"bg-success"),B.textContent=(o.prerelease?"Prerelease":"Release")+" \u2022 "+(o.date||""),f.appendChild(B),i.appendChild(f),l.appendChild(i);let E=document.createElement("div");if(E.id=`changelog-modal-${r}-${Date.now()}`,E.className="collapse mt-2",o.html){let u=document.createElement("div");u.className="changelog-entry-body",u.innerHTML=o.html;try{let m=u.querySelector("h1,h2,h3,h4,h5,h6");if(m){let p=m.querySelector("a");p&&(p.textContent=o.title||p.getAttribute("title")||p.textContent||"")}}catch{}let g=u.firstElementChild;try{if(g&&(g.tagName==="P"||g.tagName==="DIV"||g.tagName==="PRE")){let m=(g.textContent||"").trim().toLowerCase(),p=(o.version||"").toLowerCase(),D=(o.date||"").toLowerCase();(p&&m.includes(p)||D&&m.includes(D)||m.includes(" - "))&&g.remove()}}catch{}E.appendChild(u)}else{let u=document.createElement("ul");Array.isArray(o.notes)&&o.notes.forEach(g=>{let m=document.createElement("li");m.textContent=g,u.appendChild(m)}),E.appendChild(u)}i.addEventListener("click",function(u){u.preventDefault();let g=E.classList.toggle("show");h.textContent=g?"\u25BC":"\u25BA"}),l.appendChild(E),s.appendChild(l),n.appendChild(s)}),e.length>c.length){let o=document.createElement("div");o.className="text-center mt-3";let r=document.createElement("a");r.href=apiPath("/changelog/page"),r.target="_blank",r.textContent="View full changelog",o.appendChild(r),n.appendChild(o)}t.innerHTML="",t.appendChild(n)}function N(){let e=document.getElementById("changelog-body");e&&(e.innerHTML='<div class="text-center text-muted">Loading...</div>'),fetch(apiPath("/changelog")).then(t=>{if(!t.ok)throw new Error("failed to load changelog");return t.json()}).then(t=>{O(t)}).catch(t=>{let n=document.getElementById("changelog-body");n&&(n.innerHTML='<div class="text-danger">Unable to load changelog.</div>'),console.error(t)})}let H=document.getElementById("changelogModal");if(H)try{H.addEventListener("show.bs.modal",N)}catch{let t=document.querySelector('[data-bs-target="#changelogModal"]');t&&t.addEventListener("click",N)}(function(){try{if(!new URLSearchParams(window.location.search).get("cssdebug"))return;let n={"max-420":"(max-width: 420px)","max-600":"(max-width: 600px)","max-768":"(max-width: 768px)","max-1024":"(max-width: 1024px)","pointer-coarse":"(pointer: coarse)","hover-none":"(hover: none)"};console.groupCollapsed("CSS Debug \u2014 media query matches"),Object.entries(n).forEach(([a,c])=>{try{let o=window.matchMedia(c);console.log(c+":",o.matches)}catch{console.log(c+": error")}}),console.log("navigator.maxTouchPoints:",navigator.maxTouchPoints),console.log("ontouchstart in window:","ontouchstart"in window),console.groupEnd()}catch{}})(),document.body.addEventListener("taskDeleted",function(e){let t=document.querySelectorAll("#task-container span"),n=1;for(let o of t){let r=o.textContent.match(/Page\s+(\d+)\s+of\s+(\d+)/);if(r){n=parseInt(r[1]);break}}let a=`/api/fetch-tasks?page=${n}`,c=document.getElementById("search");c&&c.value&&(a+=`&search=${encodeURIComponent(c.value)}`),htmx.ajax("GET",a,{target:"#task-container",swap:"innerHTML"})}),document.body.addEventListener("reloadPage",function(e){let n=`/api/fetch-tasks?page=${e.detail.page||1}`,a=document.getElementById("search");a&&a.value&&(n+=`&search=${encodeURIComponent(a.value)}`),htmx.ajax("GET",n,{target:"#task-container",swap:"innerHTML"})}),document.body.addEventListener("reload-previous-page",function(e){let t=document.querySelectorAll("#task-container span"),n=1;for(let s of t){let l=s.textContent.match(/Page\s+(\d+)\s+of\s+(\d+)/);if(l){n=parseInt(l[1]);break}}let a=Math.max(n-1,1),c=document.getElementById("search"),o=c?c.value:"",r=`/api/fetch-tasks?page=${a}`;o&&(r+=`&search=${encodeURIComponent(o)}`),htmx.ajax("GET",r,{target:"#task-container",swap:"innerHTML"})}),document.body.addEventListener("login-success",function(e){let t=bootstrap.Modal.getInstance(document.getElementById("modal"));t&&t.hide(),window.location.reload()}),document.body.addEventListener("taskCountsChanged",function(e){try{let t=e.detail||{};if(typeof t.completed<"u"){let n=document.getElementById("completed-tasks-badge");n&&(n.textContent=`Completed: ${t.completed}`)}if(typeof t.incomplete<"u"){let n=document.getElementById("incomplete-tasks-badge");n&&(n.textContent=`Incomplete: ${t.incomplete}`)}if(typeof t.completed<"u"&&typeof t.incomplete<"u"){let n=document.getElementById("total-tasks-badge");n&&(n.textContent=`Total Tasks: ${t.completed+t.incomplete}`)}}catch{}});function j(){let e=document.querySelector(".app-toast-container");return e||(e=document.createElement("div"),e.className="app-toast-container",document.body.appendChild(e)),e}function P(e,t){t=t||{};let n=j(),a=document.createElement("div");a.className="app-toast"+(t.error?" app-toast--error":""),a.setAttribute("role","status"),a.setAttribute("aria-live","polite"),a.textContent=e,n.appendChild(a),requestAnimationFrame(()=>{a.classList.add("show")});let c=typeof t.duration=="number"?t.duration:3500,o=()=>{a.classList.remove("show"),setTimeout(()=>{try{a.remove()}catch{}},220)},r=setTimeout(o,c);a.addEventListener("click",function(){clearTimeout(r),o()})}document.body.addEventListener("favorite-limit-reached",function(e){try{let t=e&&e.detail&&e.detail.message||"You can only favorite up to 5 tasks";P(t,{error:!0})}catch{P("You can only favorite up to 5 tasks",{error:!0})}}),document.body.addEventListener("click",function(e){let t=e.target.closest&&e.target.closest(".task-toggle");if(!t||t.classList.contains("favorite-btn"))return;let n=t.closest("tr");if(!n)return;let a=n.classList.toggle("expanded");try{t.setAttribute("aria-expanded",a?"true":"false")}catch{}}),document.body.addEventListener("keydown",function(e){if(e.key!=="Enter"&&e.key!==" "&&e.key!=="Spacebar")return;let t=e.target&&e.target.closest&&e.target.closest(".task-toggle");if(!t||(e.preventDefault(),t.classList.contains("favorite-btn")))return;let n=t.closest("tr");if(!n)return;let a=n.classList.toggle("expanded");try{t.setAttribute("aria-expanded",a?"true":"false")}catch{}}),document.body.addEventListener("htmx:afterSwap",e=>{let t=document.getElementById("sidebar");if(t&&t.classList.contains("active")){let n=document.getElementById("description"),a=document.getElementById("char-count");n&&a&&(a.textContent=n.value.length,n.classList.contains("char-count-listener-added")||(n.addEventListener("input",function(){let c=this.value.length;a.textContent=c,c>90?a.classList.add("text-warning"):a.classList.remove("text-warning"),c>95?a.classList.add("text-danger"):a.classList.remove("text-danger")}),n.classList.add("char-count-listener-added"))),typeof C=="function"&&C()}}),document.body.addEventListener("htmx:afterSwap",function(e){if(e.target&&e.target.id==="task-container")try{x()}catch{}})});})();
