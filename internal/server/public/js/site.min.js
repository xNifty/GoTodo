(()=>{function h(e){return"./"+(e.startsWith("/")?e.slice(1):e)}var I=null;function M(){try{let e=document.querySelector("footer");e&&(I=e.outerHTML)}catch{}}function q(){try{if(!document.querySelector("footer")&&I){let e=document.getElementById("task-container");if(e&&e.parentNode){let t=document.createElement("div");t.innerHTML=I,e.nextSibling?e.parentNode.insertBefore(t.firstElementChild,e.nextSibling):e.parentNode.appendChild(t.firstElementChild)}else{let t=document.createElement("div");t.innerHTML=I,document.body.appendChild(t.firstElementChild)}}}catch{}}function H(){let e=document.querySelector(".app-toast-container");return e||(e=document.createElement("div"),e.className="app-toast-container",document.body.appendChild(e)),e}function A(){let e=document.getElementById("task-container");if(!e)return;let t=e.querySelector("table");if(!t)return;["table","table-striped","table-bordered","w-100","mb-3"].forEach(n=>{t.classList.contains(n)||t.classList.add(n)})}function P(){let e=document.getElementById("task-container");if(!e||e.querySelector("table"))return;let t=e.querySelector("#favorite-task-list"),o=e.querySelector("#task-list"),n=[];if(t&&n.push(t),o&&n.push(o),n.length===0){let i=Array.from(e.querySelectorAll(":scope > tr"));i.length&&n.push(...i)}if(n.length===0)return;let r=document.createElement("table");r.className="table table-striped table-bordered w-100 mb-3";let a=e.querySelector("thead");if(a){r.appendChild(a.cloneNode(!0));try{a.remove()}catch{}}let c=document.createElement("tbody");n.forEach(i=>{c.appendChild(i)}),r.appendChild(c),e.insertBefore(r,e.firstChild)}function S(){let e=document.getElementById("theme-toggle"),o=document.documentElement.getAttribute("data-theme")||localStorage.getItem("theme")||"light";document.documentElement.setAttribute("data-theme",o),o==="dark"?e&&e.classList.add("active"):e&&e.classList.remove("active")}function N(){let t=(document.documentElement.getAttribute("data-theme")||"light")==="light"?"dark":"light",o=document.getElementById("theme-toggle");document.documentElement.setAttribute("data-theme",t),localStorage.setItem("theme",t);try{document.cookie="theme="+t+"; path=/; max-age=31536000; SameSite=Lax"}catch{}t==="dark"?o&&o.classList.add("active"):o&&o.classList.remove("active")}function w(){let e=document.getElementById("theme-toggle");e&&(e.removeEventListener("click",N),e.addEventListener("click",N))}function R(){let e=document.getElementById("description"),t=document.getElementById("char-count");e&&t&&e.addEventListener("input",function(){let r=this.value.length;t.textContent=r,r>90?t.classList.add("text-warning"):t.classList.remove("text-warning"),r>95?t.classList.add("text-danger"):t.classList.remove("text-danger")});let o=document.getElementById("project-name"),n=document.getElementById("project-name-char-count");o&&n&&o.addEventListener("input",function(){let r=this.value.length;n.textContent=r,r>40?n.classList.add("text-warning"):n.classList.remove("text-warning"),r>45?n.classList.add("text-danger"):n.classList.remove("text-danger")})}function T(){let e=document.getElementById("createProjectForm"),t=document.getElementById("project-name"),o=document.getElementById("project-name-error");e&&t&&o&&(t.addEventListener("input",function(){o.innerHTML=""}),e.addEventListener("htmx:afterRequest",function(n){let r=!1;try{let a=n.detail&&n.detail.xhr,c=a&&a.getResponseHeader?a.getResponseHeader("X-Validation-Error"):null;(c&&c.toLowerCase()==="true"||n.detail&&n.detail.triggerSpec&&n.detail.triggerSpec.trigger==="project-name-error")&&(r=!0)}catch{}if(n.detail.successful&&!r){t.value="";let a=document.getElementById("project-name-char-count");a&&(a.textContent="0"),o.innerHTML=""}}))}function F(e){let t=document.getElementById("description");!t||!e||(e.textContent=t.value.length,t.classList.contains("char-count-listener-added")||(t.addEventListener("input",function(){let o=this.value.length;e.textContent=o,o>90?e.classList.add("text-warning"):e.classList.remove("text-warning"),o>95?e.classList.add("text-danger"):e.classList.remove("text-danger")}),t.classList.add("char-count-listener-added")))}function k(){let e=document.getElementById("sidebar");e&&e.classList.add("active")}function L(){let e=document.getElementById("sidebar");e&&e.classList.remove("active")}function y(){let e=document.getElementById("openSidebar"),t=document.getElementById("closeSidebar");e&&(e.removeEventListener("click",k),e.addEventListener("click",function(o){try{let n=document.getElementById("newTaskForm");if(n){let r=n.querySelector("#title");r&&(r.value="");let a=n.querySelector("#description");a&&(a.value="");let c=n.querySelector("#project_id");c&&(c.value="");let i=n.querySelector("#due_date");i&&(i.value="");let d=n.querySelector('input[name="id"]');d&&d.remove();let s=n.querySelector('button[type="submit"]');s&&(s.textContent="Add Task");try{n.setAttribute("hx-post",h("/api/add-task"))}catch{}let l=n.querySelector('input[name="currentPage"]');l&&(l.value="1");try{let u=n.querySelector('input[name="project"]'),E=document.querySelector("select#project-filter"),p=E?E.value:"";u||(u=document.createElement("input"),u.type="hidden",u.name="project",n.appendChild(u)),u.value=p}catch{}let m=document.querySelector("#sidebar .sidebar-header h5");m&&(m.textContent="Add Task");let C=document.getElementById("char-count");C&&(C.textContent="0")}}catch{}k()})),t&&(t.removeEventListener("click",L),t.addEventListener("click",L)),w();try{let o=document.getElementById("newTaskForm");if(o&&!o.classList.contains("task-form-initialized")){try{let n=o.querySelector('input[name="project"]'),r=document.querySelector("select#project-filter"),a=r?r.value:"";n||(n=document.createElement("input"),n.type="hidden",n.name="project",o.appendChild(n)),n.value=a,o.addEventListener("submit",function(){try{let c=document.querySelector("select#project-filter");c&&(n.value=c.value)}catch{}})}catch{}o.addEventListener("htmx:afterRequest",n=>{let r=!1;try{let a=n.detail&&n.detail.xhr,c=a&&a.getResponseHeader?a.getResponseHeader("X-Validation-Error"):null;(c&&c.toLowerCase()==="true"||n.detail&&n.detail.triggerSpec&&n.detail.triggerSpec.trigger==="description-error")&&(r=!0)}catch{}if(n.detail.successful&&!r){L();let a=document.getElementById("title");a&&(a.value="");let c=document.getElementById("description");c&&(c.value="");let i=document.getElementById("char-count");i&&(i.textContent="0");let d=document.getElementById("description-error");d&&(d.innerHTML="")}}),o.classList.add("task-form-initialized")}}catch{}}function _(){document.body.removeEventListener("click",D),document.body.addEventListener("click",D)}function D(e){try{if(!(e.target&&e.target.closest&&e.target.closest(".edit-btn")))return;let o=document.getElementById("sidebar");o&&o.classList.add("active")}catch{}}function $(){document.body.removeEventListener("click",z),document.body.addEventListener("click",z)}function z(e){try{if(!(e.target&&e.target.closest&&e.target.closest("#closeSidebar")))return;L()}catch{}}function O(){document.body.removeEventListener("htmx:afterSwap",V),document.body.addEventListener("htmx:afterSwap",V)}function V(e){let t=document.getElementById("sidebar");if(t&&t.classList.contains("active")){let o=document.getElementById("description"),n=document.getElementById("char-count");o&&n&&F(n),typeof S=="function"&&S()}}function v(){let e=document.getElementById("modal");if(e){e.classList.contains("modal-listeners-initialized")||(e.addEventListener("hide.bs.modal",()=>{document.activeElement instanceof HTMLElement&&document.activeElement.blur()}),e.addEventListener("hidden.bs.modal",()=>{e.setAttribute("aria-hidden","true")}),e.classList.add("modal-listeners-initialized"));try{typeof bootstrap<"u"&&bootstrap.Modal&&typeof bootstrap.Modal.getOrCreateInstance=="function"&&bootstrap.Modal.getOrCreateInstance(e)}catch{}}}function Q(e){let t=document.getElementById("changelog-body");if(!t)return;if(!e||!e.length){t.innerHTML='<div class="text-center text-muted">No changelog entries available.</div>';return}let o=document.createElement("div");o.className="changelog-list";let r=e.slice(0,5);if(r.forEach((a,c)=>{let i=document.createElement("div");i.className="card mb-3";let d=document.createElement("div");d.className="card-body";let s=document.createElement("button");s.type="button",s.className="btn btn-link text-start w-100 p-0 d-flex align-items-center",s.style.textDecoration="none";let l=document.createElement("span");l.className="chev me-2",l.textContent="\u25BA",s.appendChild(l);let m=document.createElement("div");m.className="flex-grow-1 text-start";let C=document.createElement("strong");C.textContent=a.title||"",m.appendChild(C);let u=document.createElement("span");u.className="badge releasetag ms-3 "+(a.prerelease?"bg-warning text-dark":"bg-success"),u.textContent=(a.prerelease?"Prerelease":"Release")+" \u2022 "+(a.date||""),m.appendChild(u),s.appendChild(m),d.appendChild(s);let E=document.createElement("div");if(E.id=`changelog-modal-${c}-${Date.now()}`,E.className="collapse mt-2",a.html){let p=document.createElement("div");p.className="changelog-entry-body",p.innerHTML=a.html;try{let f=p.querySelector("h1,h2,h3,h4,h5,h6");if(f){let b=f.querySelector("a");b&&(b.textContent=a.title||b.getAttribute("title")||b.textContent||"")}}catch{}let g=p.firstElementChild;try{if(g&&(g.tagName==="P"||g.tagName==="DIV"||g.tagName==="PRE")){let f=(g.textContent||"").trim().toLowerCase(),b=(a.version||"").toLowerCase(),j=(a.date||"").toLowerCase();(b&&f.includes(b)||j&&f.includes(j)||f.includes(" - "))&&g.remove()}}catch{}E.appendChild(p)}else{let p=document.createElement("ul");Array.isArray(a.notes)&&a.notes.forEach(g=>{let f=document.createElement("li");f.textContent=g,p.appendChild(f)}),E.appendChild(p)}s.addEventListener("click",function(p){p.preventDefault();let g=E.classList.toggle("show");l.textContent=g?"\u25BC":"\u25BA"}),d.appendChild(E),i.appendChild(d),o.appendChild(i)}),e.length>r.length){let a=document.createElement("div");a.className="text-center mt-3";let c=document.createElement("a");c.href=h("/changelog/page"),c.textContent="View full changelog",a.appendChild(c),o.appendChild(a)}t.innerHTML="",t.appendChild(o)}function X(){let e=document.getElementById("changelog-body");e&&(e.innerHTML='<div class="text-center text-muted">Loading...</div>'),fetch(h("/changelog")).then(t=>{if(!t.ok)throw new Error("failed to load changelog");return t.json()}).then(t=>{Q(t)}).catch(t=>{let o=document.getElementById("changelog-body");o&&(o.innerHTML='<div class="text-danger">Unable to load changelog.</div>'),console.error(t)})}function U(){let e=document.getElementById("changelogModal");if(e)try{e.addEventListener("show.bs.modal",X)}catch{let o=document.querySelector('[data-bs-target="#changelogModal"]');o&&o.addEventListener("click",X)}}function B(){try{if(typeof Sortable>"u")return;let e=document.getElementById("favorite-task-list"),t=document.getElementById("task-list"),o=(n,r)=>{if(n){if(n._sortable)try{n._sortable.destroy()}catch{}n._sortable=Sortable.create(n,{handle:".drag-handle",animation:150,onEnd:function(a){let c=Array.from(a.to.children).map(s=>(s.id||"").replace("task-","")).filter(Boolean).join(","),i=new URLSearchParams;i.append("order",c),i.append("is_favorite",r?"true":"false");let d=document.querySelector('#task-container [name="currentPage"]');d&&d.value&&i.append("page",d.value);try{let s=document.querySelector("select#project-filter"),l=s?s.value:"";typeof l<"u"&&l!==null&&i.append("project",l)}catch{}fetch(h("/api/reorder-tasks"),{method:"POST",body:i}).then(s=>{if(s.ok)return s.text();throw new Error("Failed to save order")}).then(s=>{let l=document.getElementById("task-container");if(l){l.innerHTML=s;try{typeof htmx<"u"&&htmx.process(l)}catch{}try{B()}catch{}try{typeof y=="function"&&y()}catch{}try{typeof v=="function"&&v()}catch{}try{q()}catch{}}}).catch(s=>{console.error("Reorder failed",s)})}})}};o(e,!0),o(t,!1)}catch{}}function G(){B(),document.body.addEventListener("htmx:afterSwap",function(e){if(e.target.id==="task-container"){try{P(),A()}catch{}B()}})}function x(e,t){t=t||{};let o=H(),n=document.createElement("div");n.className="app-toast"+(t.error?" app-toast--error":""),n.setAttribute("role","status"),n.setAttribute("aria-live","polite"),n.textContent=e,o.appendChild(n),requestAnimationFrame(()=>{n.classList.add("show")});let r=typeof t.duration=="number"?t.duration:3500,a=()=>{n.classList.remove("show"),setTimeout(()=>{try{n.remove()}catch{}},220)},c=setTimeout(a,r);n.addEventListener("click",function(){clearTimeout(c),a()})}function W(){document.body.addEventListener("favorite-limit-reached",function(e){try{let t=e&&e.detail&&e.detail.message||"You can only favorite up to 5 tasks";x(t,{error:!0})}catch{x("You can only favorite up to 5 tasks",{error:!0})}})}function J(){document.body.addEventListener("taskDeleted",function(e){let t=document.querySelectorAll("#task-container span"),o=1;for(let a of t){let c=a.textContent.match(/Page\s+(\d+)\s+of\s+(\d+)/);if(c){o=parseInt(c[1]);break}}let n=`/api/fetch-tasks?page=${o}`,r=document.getElementById("search");r&&r.value&&(n+=`&search=${encodeURIComponent(r.value)}`),htmx.ajax("GET",n,{target:"#task-container",swap:"innerHTML"})})}function K(){document.body.addEventListener("reloadPage",function(e){let o=`/api/fetch-tasks?page=${e.detail.page||1}`,n=document.getElementById("search");n&&n.value&&(o+=`&search=${encodeURIComponent(n.value)}`),htmx.ajax("GET",o,{target:"#task-container",swap:"innerHTML"})})}function Z(){document.body.addEventListener("reload-previous-page",function(e){let t=document.querySelectorAll("#task-container span"),o=1;for(let i of t){let d=i.textContent.match(/Page\s+(\d+)\s+of\s+(\d+)/);if(d){o=parseInt(d[1]);break}}let n=Math.max(o-1,1),r=document.getElementById("search"),a=r?r.value:"",c=`/api/fetch-tasks?page=${n}`;a&&(c+=`&search=${encodeURIComponent(a)}`),htmx.ajax("GET",c,{target:"#task-container",swap:"innerHTML"})})}function ee(){document.body.addEventListener("login-success",function(e){let t=bootstrap.Modal.getInstance(document.getElementById("modal"));t&&t.hide(),window.location.reload()})}function te(){document.body.addEventListener("taskCountsChanged",function(e){try{let t=e.detail||{};if(typeof t.completed<"u"){let o=document.getElementById("completed-tasks-badge");o&&(o.textContent=`Completed: ${t.completed}`)}if(typeof t.incomplete<"u"){let o=document.getElementById("incomplete-tasks-badge");o&&(o.textContent=`Incomplete: ${t.incomplete}`)}if(typeof t.completed<"u"&&typeof t.incomplete<"u"){let o=document.getElementById("total-tasks-badge");o&&(o.textContent=`Total Tasks: ${t.completed+t.incomplete}`)}}catch{}})}function ne(){document.body.addEventListener("htmx:afterRequest",function(e){try{let t=e&&e.detail&&e.detail.xhr;if(!t||!t.responseURL)return;if(t.responseURL.includes("/api/edit")){let o=t.status||0;if(o>=200&&o<300){try{y()}catch{}let n=document.getElementById("sidebar");n&&n.classList.add("active")}}if(t.responseURL.includes("/api/projects/create")){let o=t.status||0,n=t.getResponseHeader&&t.getResponseHeader("X-Validation-Error")==="true";if(o>=200&&o<300&&!n)try{let r=document.getElementById("createProjectForm");if(r){let a=r.querySelector('input[name="name"]');a&&(a.value="");let c=document.getElementById("project-name-char-count");c&&(c.textContent="0");let i=document.getElementById("project-name-error");i&&(i.innerHTML="")}T(),typeof x=="function"&&x("Project created.")}catch{}}try{if(t&&t.getResponseHeader&&t.getResponseHeader("HX-Trigger")){let o=t.getResponseHeader("HX-Trigger");if(o&&o.indexOf("projects-changed")!==-1&&fetch(h("/api/projects/json")).then(n=>n.json()).then(n=>{try{document.querySelectorAll("select#project_id").forEach(a=>{let c=a.value;for(;a.options.length>1;)a.remove(1);n.forEach(i=>{let d=document.createElement("option");d.value=i.id,d.textContent=i.name,a.appendChild(d)});try{a.value=c}catch{}})}catch{}}).catch(()=>{}),o&&o.indexOf("reset-project-filter")!==-1)try{let n=document.querySelector("select#project-filter");n&&(n.value="",n.dispatchEvent(new Event("change",{bubbles:!0})))}catch{}if(o&&o.indexOf("set-project-filter")!==-1)try{let n=o.match(/set-project-filter:([^\s]+)/);if(n&&n[1]!==void 0){let r=n[1],a=document.querySelector("select#project-filter");a&&(a.value=r)}}catch{}}}catch{}}catch{}})}function oe(){document.body.addEventListener("htmx:afterSettle",e=>{if(e.target.id==="task-container"){y();let t=document.getElementById("sidebar");t&&t.classList.contains("htmx-added")&&t.classList.add("active")}})}function ae(){O(),document.body.addEventListener("htmx:afterSwap",function(e){try{let t=e.detail&&e.detail.target?e.detail.target:e.target;if(t&&t.id==="sidebar"){try{y()}catch{}let o=document.getElementById("sidebar");o&&o.classList.add("active")}}catch{}}),document.body.addEventListener("htmx:afterSwap",function(e){try{let t=e&&e.detail,o=t&&t.target?t.target:e.target;if(o&&o.id==="sidebar")return;if(o&&o.classList&&o.classList.contains("sidebar-body")){try{y()}catch{}let n=document.getElementById("sidebar");n&&n.classList.add("active")}}catch{}}),document.body.addEventListener("htmx:afterSwap",function(e){if(e.target&&e.target.id==="task-container")try{v()}catch{}})}function Y(){J(),K(),Z(),ee(),te(),ne(),oe(),ae(),_(),$()}window.apiPath=h;window.showToast=x;window.closeSidebar=L;window.openSidebar=k;document.addEventListener("DOMContentLoaded",()=>{M(),S(),w(),R(),T(),y(),G(),v(),U(),W(),Y(),function(){try{if(!new URLSearchParams(window.location.search).get("cssdebug"))return;let o={"max-420":"(max-width: 420px)","max-600":"(max-width: 600px)","max-768":"(max-width: 768px)","max-1024":"(max-width: 1024px)","pointer-coarse":"(pointer: coarse)","hover-none":"(hover: none)"};console.groupCollapsed("CSS Debug \u2014 media query matches"),Object.entries(o).forEach(([n,r])=>{try{let a=window.matchMedia(r);console.log(r+":",a.matches)}catch{console.log(r+": error")}}),console.log("navigator.maxTouchPoints:",navigator.maxTouchPoints),console.log("ontouchstart in window:","ontouchstart"in window),console.groupEnd()}catch{}}()});})();
